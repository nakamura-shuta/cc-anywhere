
# CC-Anywhere TODO List

計画・実装時は以下のドキュメントの仕様に従って実装してください。
* https://docs.anthropic.com/ja/docs/claude-code/sdk

## 優先テスト

* セッション継続テスト(会話の継続)

## 🔧 修正が必要な問題

## 🎯 優先実装したい機能

### 高優先度 🔴
1. **逐次実行モード**
   - 複数タスクの順次実行
   - 前のタスクの結果を次のタスクに渡す
   - パイプライン機能

### 中優先度 🟡
1. **タスクテンプレート機能**
   - よく使うタスクをテンプレート化
   - パラメータ化されたテンプレート
   - テンプレートマーケットプレイス

2. **実行結果の可視化**
   - 統計ダッシュボード
   - 実行時間の分析
   - エラー率の可視化

3. **認証・権限管理の強化**
   - ユーザー管理機能
   - ロールベースアクセス制御
   - APIキーの詳細な権限設定

### 低優先度 🟢
1. **`permissionPromptTool`** - カスタム権限確認ツール
   - カスタム権限確認ロジックの実装
   - 高度なセキュリティ要件への対応

2. **ストリーミング入力サポート**
   - 大規模な入力データのストリーミング処理
   - メモリ効率の改善

## 🚀 最近の実装成果

### フロントエンドのリファクタリング ✅ (2025-01-14)
- JavaScript共通関数をutils.jsに集約
  - クエリパラメータ処理、HTML エスケープ、日時フォーマット
  - 通知表示、ナビゲーションリンク更新、接続状態監視
- CSS共通スタイルをcommon.cssに集約
  - 通知、接続状態、モーダル、ボタン、フォーム、ページネーション
- コードの重複を大幅に削減
- メンテナンス性の向上

### スケジューラー機能のUI改善 ✅ (2025-01-14)
- タスク実行画面とスケジューラー画面のスタイルを完全に統一
- ナビゲーションリンクにクエリパラメータを引き継ぐ機能を追加
- 接続状態チェックのエンドポイントを修正
- 不要なファイルを削除（index-simple.html, app-simple.js）

### タイマー投稿（スケジュール実行）機能 ✅
- Cron式による定期実行（5フィールド形式）
- ワンタイム実行（指定日時での1回限り実行）
- タイムゾーン対応（Cronスケジュール）
- 実行履歴の記録と管理
- スケジュールの有効化/無効化
- REST APIによる完全な管理機能
- Web UIからのスケジュール管理
- 詳細: [スケジューラー機能ドキュメント](./docs/features/scheduler.md)

### 権限モード実装の改善
- Claude Code SDKの権限モードを正しく実装
- `ask` → `default`, `allow` → `bypassPermissions`, `deny` → `plan` へのマッピング
- Web UIも SDK に合わせて更新（default, acceptEdits, bypassPermissions, plan）
- cc-anywhere経由でもファイル作成が可能に（permissionMode: "allow"指定で）

### タスク実行ログ・結果表示の改善 ✅
- ツール使用情報の詳細表示（Read/Write/Edit/Bash等）をリアルタイムで実装
- タスク実行サマリーの生成（使用ツール統計、ファイル操作一覧、実行時間等）
- WebSocket経由で構造化されたログ情報（tool_usage, progress, summary）を送信
- 各ツールにアイコンを設定（📖読取、✏️作成、📝編集、💻コマンド等）
- エラー時の詳細情報表示の改善
- Markdown形式の結果を適切にレンダリング
- ネストされたJSONレスポンス（task.result.result）に対応

### 自己組織化型並列実行
- 司令塔パターンによるタスクの自律的な並列実行を実現
- タスクがHTTP API経由で他のタスクを作成・管理
- Git worktreeを使用した独立環境での安全な並列実行
- 詳細: [自己組織化型並列実行ドキュメント](./docs/self-organized-parallel-execution.md)

## 📋 実装済み機能一覧

<details>
<summary>Claude Code SDK オプション（全実装済み）</summary>

### 基本オプション ✅
- `maxTurns` - 会話ターン数の制限（1-50）
- `allowedTools` / `disallowedTools` - ツール使用の制限
- `systemPrompt` - カスタムシステムプロンプト（最大10,000文字）
- `permissionMode` - 編集権限の制御（ask/allow/deny/plan）
- `executable` / `executableArgs` - 実行環境の指定
- `mcpConfig` - Model Context Protocol設定
- `continueSession` / `resumeSession` - セッション継続機能
- `verbose` - 詳細ログ出力

### プリセット管理 ✅
- 設定の保存/読み込み機能
- システムプリセットとユーザープリセット
- Web UIからの管理機能

### Web UI改善 ✅
- SDKオプション対応版をデフォルトに
- レスポンシブデザイン対応
- スマートフォン操作性向上

### タスク一覧のページネーション ✅
- APIレベルでのページング対応
- Web UIでのページナビゲーション
- 表示件数選択機能（10, 20, 50, 100件）
- 大量タスク時のパフォーマンス改善

</details>

## 🛠️ その他の改善項目

### Web UI改善 ✅
- もっと使いやすいUIに改善
- フロントエンドのリファクタリング実施（2025-01-14）
- タスク実行画面とスケジューラー画面のスタイル統一（2025-01-14）

### エラーハンドリングの強化
- Claude Code SDK特有のエラーパターンへの対応
- より詳細なエラーメッセージの提供
- エラーリカバリー機能

### パフォーマンスの最適化
- 大規模プロジェクトでの実行速度改善
- メモリ使用量の削減
- 並列実行の効率化

### セキュリティの強化
- API認証の改善
- ツール実行権限の細かい制御
- 監査ログ機能

## 📝 Git Worktree機能の動作仕様

### 基本動作
- Worktreeは独立した作業ディレクトリとして作成
- メインリポジトリとは別の場所で作業を実行
- デフォルトではタスク完了後に自動クリーンアップ

### クリーンアップ時の動作
1. **デフォルト動作**（autoCleanup: true）
   - 未コミットの変更は自動的にパッチファイルとして保存
   - パッチは `.worktree-backups/` ディレクトリに保存
   - worktreeとブランチは削除

2. **keepAfterCompletion有効時**
   - Worktreeは削除されない
   - 作成・修正したファイルはそのまま保持
   - 手動でコミット・マージ等の操作が可能

### 設定例
```typescript
{
  options: {
    worktree: {
      enabled: true,
      branchName: "feature/task-123",
      keepAfterCompletion: true  // タスク完了後も保持
    }
  }
}
```