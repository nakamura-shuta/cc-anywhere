# アーキテクチャの選択：統合版 vs 分離版

CC-Anywhereは2つのデプロイメントアーキテクチャをサポートしています。

## 統合版（推奨）

フロントエンドをビルドしてバックエンドに統合し、単一のプロセスで配信。

```bash
./scripts/start-production.sh
```

### 構成
```
┌─────────────────┐
│   ブラウザ      │
└────────┬────────┘
         │ :5000
┌────────┴────────┐
│  バックエンド   │
│  ├─ API        │
│  └─ 静的ファイル│
└─────────────────┘
```

### メリット
- ✅ シンプルな構成
- ✅ 単一ポート（5000）
- ✅ CORS設定不要
- ✅ デプロイが簡単
- ✅ 管理が簡単

### デメリット
- ❌ フロントエンドの更新でAPI再起動
- ❌ スケーリングが難しい
- ❌ CDN活用が難しい

### 適している場合
- 小〜中規模のチーム
- シンプルさを重視
- 単一サーバーで運用
- 社内ツールとして使用

## 分離版

フロントエンドとバックエンドを別々のプロセスで起動。

```bash
./scripts/start-production-separate.sh
```

### 構成
```
┌─────────────────┐
│   ブラウザ      │
└───┬─────────┬───┘
    │ :4444   │ :5000
┌───┴───┐ ┌───┴───┐
│ Front │ │ Back  │
│ end   │ │ end   │
└───────┘ └───────┘
```

### メリット
- ✅ 独立したスケーリング
- ✅ CDN活用可能
- ✅ 独立したデプロイ
- ✅ 開発と同じ構成

### デメリット
- ❌ 複雑な構成
- ❌ CORS設定必要
- ❌ 複数ポート管理
- ❌ リバースプロキシ推奨

### 適している場合
- 大規模チーム
- マイクロサービス志向
- 高トラフィック
- グローバル展開

## 設定の違い

### 統合版の設定

バックエンドがすべてを処理：
```javascript
// backend/src/server/plugins/static.ts
// フロントエンドの静的ファイルを配信
```

### 分離版の設定

1. **バックエンドのCORS設定**:
   ```env
   # .env
   CORS_ORIGIN=http://localhost:4444,https://your-domain.com
   ```

2. **フロントエンドのAPI設定**:
   ```javascript
   // frontend/src/lib/config/api.ts
   export const API_BASE_URL = 'http://localhost:5000';
   ```

## パフォーマンス比較

| 項目 | 統合版 | 分離版 |
|------|--------|--------|
| 初回ロード | 速い | CDN使用で速い |
| API遅延 | 最小 | ネットワーク依存 |
| スケーラビリティ | 垂直のみ | 水平・垂直 |
| リソース使用 | 効率的 | 分散 |

## 移行ガイド

### 統合版 → 分離版

1. CORS設定を更新
2. `start-production-separate.sh`を使用
3. リバースプロキシを設定（オプション）

### 分離版 → 統合版

1. フロントエンドをビルド
2. `build-all.sh`を実行
3. `start-production.sh`を使用

## 推奨事項

### 開発・テスト環境
- 分離版（`start-dev.sh`）
- ホットリロードが有効

### 本番環境
- **デフォルト**: 統合版
- **高トラフィック**: 分離版 + CDN
- **企業環境**: 分離版 + リバースプロキシ

## セキュリティ考慮事項

### 統合版
- APIとUIが同一オリジン
- CSRF対策が簡単
- 認証の一元管理

### 分離版
- CORS設定が重要
- 各サービスで認証
- ネットワーク分離可能

## まとめ

- **シンプルさ重視** → 統合版
- **柔軟性重視** → 分離版
- **迷ったら** → 統合版から始める

どちらを選んでも、後から変更可能です。