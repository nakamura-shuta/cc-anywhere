# SDKオプションUI実装ガイド

## 概要
CC-AnywhereのWeb UIにClaude Code SDKオプションを追加する実装ガイドです。
UXを重視し、モバイルファーストで使いやすいインターフェースを提供します。

## 実装ファイル

### 1. 新規作成ファイル
- `index-sdk-options.html` - SDKオプション対応版のHTML
- `style-sdk-options.css` - 追加スタイルシート
- `app-sdk-options.js` - SDKオプション処理のJavaScript

### 2. 既存ファイルへの統合方法

#### index.htmlの更新
1. SDKオプションセクションを追加
2. 既存のallowedToolsセクションを新しいツール制限設定に置き換え
3. style-sdk-options.cssへのリンクを追加

#### app.jsの更新
1. SDKオプション関連の関数を追加
2. handleTaskSubmit関数をhandleTaskSubmitWithSDKに置き換え
3. 初期化処理にSDKオプションのセットアップを追加

## 主な機能

### 1. プリセット機能
- **ベーシック**: 一般的なタスク用の推奨設定
- **制限モード**: 安全性重視の設定
- **フルアクセス**: すべての機能を有効化

### 2. 基本設定（常時表示）
- **最大ターン数**: スライダーと数値入力の組み合わせ
- **権限モード**: 4つのモードから選択可能なトグルボタン
- **システムプロンプト**: 文字数カウンター付きテキストエリア

### 3. ツール制限（改良版）
- 許可/禁止の2つのタブで管理
- クイックアクション（すべて選択、すべて解除、安全なツールのみ）
- カスタムツールの入力フィールド

### 4. 高度な設定（折りたたみ可能）
- 出力形式（text/json）
- 実行環境の選択
- MCP設定（JSONバリデーション付き）
- セッション管理オプション
- 詳細ログの有効化

## モバイル対応の特徴

### タッチ操作の最適化
- 最小タッチターゲット: 44px
- 大きめのスライダーつまみ（24px）
- タッチしやすいチェックボックス（20px）

### レスポンシブレイアウト
- 768px以下でモバイルレイアウトに切り替え
- トグルボタンを2x2グリッドに配置
- タブボタンを縦並びに変更
- フォーム要素を縦並びに調整

## 実装のポイント

### 1. プログレッシブディスクロージャー
```javascript
// 基本設定のみ表示し、高度な設定は折りたたみ
<details class="advanced-settings">
    <summary>高度な設定</summary>
    <!-- 高度な設定の内容 -->
</details>
```

### 2. リアルタイムバリデーション
```javascript
// MCP設定のJSONバリデーション
mcpConfig.addEventListener('input', debounce((e) => {
    validateMCPConfig(e.target.value, mcpValidation);
}, 500));
```

### 3. 視覚的フィードバック
- スライダー操作時の数値表示更新
- 文字数カウンターの色変更（警告/エラー）
- バリデーションメッセージの表示

## APIとの統合

### タスクデータの構造
```javascript
{
    instruction: "タスクの指示",
    context: {},
    options: {
        timeout: 600000,
        sdk: {
            maxTurns: 3,
            permissionMode: "ask",
            systemPrompt: "プロンプト",
            allowedTools: ["Read", "Write"],
            disallowedTools: ["Bash"],
            outputFormat: "text",
            executable: "node",
            mcpConfig: {},
            continueSession: false,
            verbose: false
        }
    }
}
```

## テスト項目

### 機能テスト
- [ ] プリセット選択による値の自動設定
- [ ] スライダーと数値入力の同期
- [ ] タブ切り替えの動作
- [ ] JSONバリデーションの正確性
- [ ] フォーム送信時のデータ収集

### モバイルテスト
- [ ] タッチ操作の反応性
- [ ] レイアウトの崩れ確認
- [ ] 横スクロールが発生しないこと
- [ ] キーボード表示時の挙動

### アクセシビリティテスト
- [ ] キーボードナビゲーション
- [ ] スクリーンリーダー対応
- [ ] 色コントラスト比

## 段階的な実装

### Phase 1（必須）
- 基本設定の実装
- プリセット機能
- モバイル対応

### Phase 2（推奨）
- ツール制限の改良
- リアルタイムバリデーション

### Phase 3（オプション）
- 高度な設定
- アニメーション効果
- ダークモード対応

## 注意事項

1. **後方互換性**: 既存のallowedToolsオプションとの互換性を維持
2. **エラーハンドリング**: JSONパースエラーなどを適切に処理
3. **パフォーマンス**: debounceを使用して過度な処理を防止