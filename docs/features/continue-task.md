# 継続タスク機能

## 概要

継続タスク機能を使用すると、完了したタスクの結果と会話履歴を引き継いで、新しいタスクを作成できます。これにより、複数の関連するタスクを連続して実行する際に、コンテキストを維持しながら作業を進めることができます。

## 主な特徴

- **会話履歴の引き継ぎ**: 前のタスクでの会話内容がClaudeに引き継がれます
- **作業ディレクトリの柔軟な指定**: デフォルトでは同じディレクトリで実行されますが、必要に応じて別のディレクトリを指定可能
- **コンテキストの保持**: 前のタスクで行った変更や作成したファイルを前提として作業を継続

## 使い方

### Web UIから

1. 完了したタスクの詳細画面を開く
2. 「継続タスクを作成」ボタンをクリック
3. 新しい指示内容を入力
4. （オプション）「別の作業ディレクトリで実行」にチェックを入れて、新しいディレクトリを指定
5. 「継続タスクを作成」ボタンをクリック

### APIから

```bash
# 基本的な継続タスク（同じ作業ディレクトリ）
curl -X POST http://localhost:5000/api/tasks/{parentTaskId}/continue \
  -H "Content-Type: application/json" \
  -d '{
    "instruction": "前回作成したファイルに追記してください"
  }'

# 異なる作業ディレクトリを指定
curl -X POST http://localhost:5000/api/tasks/{parentTaskId}/continue \
  -H "Content-Type: application/json" \
  -d '{
    "instruction": "前回の内容を参考に、新しいプロジェクトを作成してください",
    "context": {
      "workingDirectory": "/path/to/new/project"
    }
  }'
```

## 作業ディレクトリの変更

継続タスクでは、必要に応じて異なる作業ディレクトリを指定できます。これは以下のような場合に便利です：

- 前のタスクで学習した内容を別のプロジェクトに適用したい場合
- テンプレートやサンプルコードを参考に、新しいプロジェクトを作成したい場合
- 複数のリポジトリにまたがる作業を行いたい場合

### 注意点

- 作業ディレクトリを変更しても、会話履歴は引き継がれます
- 前のディレクトリのファイルは直接アクセスできなくなりますが、会話の中で言及することは可能です
- 新しいディレクトリが存在しない場合は、自動的に作成されます（権限がある場合）

## 技術的な詳細

### APIエンドポイント

- `POST /api/tasks/{taskId}/continue` - 継続タスクを作成

### リクエストボディ

```typescript
interface ContinueTaskRequest {
  instruction: string;
  context?: {
    workingDirectory?: string;  // 省略時は親タスクと同じディレクトリ
    // その他のコンテキスト情報
  };
  options?: {
    timeout?: number;
    async?: boolean;
    // その他のオプション
  };
}
```

### 内部動作

1. 親タスクの会話履歴を取得
2. 新しいタスクのシステムプロンプトに会話履歴を含める
3. 指定された作業ディレクトリ（または親と同じディレクトリ）で実行
4. SDKセッションIDを引き継ぎ、Claude Code SDKのセッション継続機能を活用

## ベストプラクティス

1. **明確な指示**: 継続タスクでは「前回の続きから」のような曖昧な指示でも理解されますが、具体的な指示の方が確実です
2. **作業ディレクトリの確認**: 異なるディレクトリを指定する場合は、パスが正しいことを確認してください
3. **適切なタイミング**: タスクが完了してから継続タスクを作成してください（実行中のタスクからは継続できません）