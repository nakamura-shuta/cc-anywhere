# アーキテクチャ概要

CC-Anywhereのシステム設計と技術構成について説明します。

## 🏗 システム構成

```
┌─────────────────┐     ┌─────────────────┐
│   Web Browser   │────▶│   Web UI (SPA)  │
└─────────────────┘     └─────────────────┘
         │                       │
         │ HTTP/WebSocket        │ Static Files
         ▼                       ▼
┌─────────────────────────────────────────┐
│          Fastify HTTP Server            │
│  ┌─────────────┐    ┌───────────────┐  │
│  │  REST API   │    │  Static Files │  │
│  └─────────────┘    └───────────────┘  │
│          │                              │
│  ┌───────▼────────┐ ┌─────────────────┐│
│  │ Claude Code SDK│ │ WebSocket Server││
│  └────────────────┘ └─────────────────┘│
│          │                              │
│  ┌───────▼────────┐ ┌─────────────────┐│
│  │  Task Queue    │ │    SQLite DB    ││
│  └────────────────┘ └─────────────────┘│
└─────────────────────────────────────────┘
```

## 💻 技術スタック

### バックエンド
- **言語**: TypeScript / Node.js
- **Webフレームワーク**: Fastify
- **AI**: Claude Code SDK, Claude API
- **データベース**: SQLite (Better SQLite3)
- **リアルタイム**: WebSocket (ws)
- **プロセス管理**: PM2

### フロントエンド
- **フレームワーク**: SvelteKit
- **UI**: shadcn-svelte + Tailwind CSS
- **状態管理**: Svelte 5 Runes
- **ビルド**: Vite
- **デプロイ**: Static Adapter

## 📁 ディレクトリ構造

```
cc-anywhere/
├── backend/            # バックエンドアプリケーション
│   ├── src/           # ソースコード
│   │   ├── server/    # HTTPサーバー
│   │   ├── claude/    # Claude SDK統合
│   │   ├── services/  # ビジネスロジック
│   │   ├── queue/     # タスクキュー
│   │   └── db/        # データベース
│   ├── dist/          # ビルド成果物
│   └── web/           # フロントエンド統合
├── frontend/          # フロントエンドアプリケーション
│   ├── src/           # ソースコード
│   └── build/         # ビルド成果物
├── scripts/           # 運用スクリプト
├── docs/              # ドキュメント
└── .env               # 環境設定
```

## 🔄 データフロー

1. **HTTPリクエスト** → Fastify Router → Service Layer → Claude SDK
2. **WebSocket接続** → WebSocket Server → Event Emitter → Client
3. **タスクキュー** → Task Queue → Worker → Task Executor → Claude SDK
4. **データ永続化** → Repository Layer → SQLite Database

## 🚀 実行モード

### 1. インラインモード（デフォルト）
- メインプロセスでタスクを実行
- シンプルで高速
- 小規模タスク向け

### 2. スタンドアロンモード
- 外部ワーカープロセスで実行
- メインプロセスの安定性向上
- 大規模タスク向け

### 3. マネージドモード
- 子プロセスワーカーを自動管理
- スケーラビリティ重視
- エンタープライズ向け

## 🔐 セキュリティ

- **QR認証**: モバイルアクセス用トークン認証
- **APIキー認証**: 従来のヘッダーベース認証
- **CORS設定**: オリジン制御
- **Helmet.js**: セキュリティヘッダー
- **入力検証**: スキーマベースバリデーション

## 🎯 設計原則

1. **モジュラー設計**: 機能ごとに分離された構造
2. **レイヤー分離**: プレゼンテーション・ビジネス・データ層
3. **依存性注入**: テスタビリティの向上
4. **イベント駆動**: 非同期処理の効率化
5. **型安全性**: TypeScriptによる静的型付け

## 📊 パフォーマンス最適化

- **接続プール**: データベース接続の効率化
- **キャッシュ**: 頻繁にアクセスされるデータ
- **遅延読み込み**: 必要時のみリソース読み込み
- **バッチ処理**: 複数操作の一括実行
- **ストリーミング**: 大容量データの効率的な転送