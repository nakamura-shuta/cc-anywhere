# スケジューラーUI実装設計書

## 概要
cc-anywhere プロジェクトのスケジューラー機能のUI実装設計書です。
既存のタスク管理システムと統合された、シンプルで使いやすいスケジューラーUIを実装します。

## 設計方針

### 1. ユーザビリティ
- タスクリストページと同じ操作感
- 直感的なCron式入力（ヘルパー付き）
- 視覚的にわかりやすいステータス表示
- リアルタイム更新（WebSocket対応）

### 2. 技術スタック
- **Framework**: SvelteKit + Svelte 5 (Runes)
- **UI Components**: shadcn-svelte
- **State Management**: Svelte Runes ($state, $derived)
- **API Client**: 既存のscheduleServiceを使用
- **Form Validation**: Zod + sveltekit-superforms

## 画面構成

### 1. スケジュール一覧画面 (/scheduler)

#### レイアウト
```
+--------------------------------------------------+
| スケジューラー                       [新規作成]    |
+--------------------------------------------------+
| 検索 [_______________] ステータス [▼すべて]       |
+--------------------------------------------------+
| □ | 名前 | 次回実行 | 頻度 | ステータス | アクション |
+--------------------------------------------------+
| □ | DBバックアップ | 2025/1/25 02:00 | 毎日 | ● | ⚙ |
| □ | レポート生成   | 2025/1/31 09:00 | 毎月 | ● | ⚙ |
| □ | テスト実行     | - | 1回のみ | ✓ | ⚙ |
+--------------------------------------------------+
| < 前へ | 1 2 3 | 次へ >                          |
+--------------------------------------------------+
```

#### 機能
- **一覧表示**: ページネーション対応
- **検索**: 名前での絞り込み
- **フィルタ**: ステータスでのフィルタリング
- **一括操作**: 複数選択して有効/無効化、削除
- **個別操作**: 各行のメニューから編集、削除、履歴確認
- **ステータス表示**:
  - ● 有効（active）
  - ○ 無効（inactive）
  - ✓ 完了（completed）
  - ✗ 失敗（failed）

### 2. スケジュール作成/編集ダイアログ

#### フォーム構成
```
+--------------------------------------------------+
| 新規スケジュール作成                         [×] |
+--------------------------------------------------+
| 基本情報                                         |
| 名前* [_____________________]                    |
| 説明  [_____________________]                    |
+--------------------------------------------------+
| タスク設定                                       |
| 指示* [_____________________]                    |
|       [_____________________]                    |
| 作業ディレクトリ [____________]                  |
+--------------------------------------------------+
| スケジュール設定                                 |
| タイプ (●) 繰り返し ( ) 1回のみ                 |
|                                                  |
| [繰り返しの場合]                                 |
| Cron式* [________________] [?]                   |
| よく使うパターン:                                |
| [毎時] [毎日] [毎週] [毎月]                      |
|                                                  |
| [1回のみの場合]                                  |
| 実行日時* [____年__月__日] [__:__]              |
|                                                  |
| タイムゾーン [Asia/Tokyo ▼]                     |
+--------------------------------------------------+
| 詳細設定                                         |
| タイムアウト [300] 秒                            |
| リトライ     [▼ なし]                           |
+--------------------------------------------------+
|                        [キャンセル] [作成]       |
+--------------------------------------------------+
```

#### Cron式ヘルパー
- プリセットボタン（毎時、毎日など）
- 入力検証とプレビュー（次の5回の実行時刻を表示）
- ツールチップでCron式の説明

### 3. 実行履歴モーダル

```
+--------------------------------------------------+
| 実行履歴 - DBバックアップ                    [×] |
+--------------------------------------------------+
| 実行日時          | ステータス | タスクID | 詳細 |
+--------------------------------------------------+
| 2025/1/24 02:00  | 成功      | abc123  | [表示] |
| 2025/1/23 02:00  | 成功      | def456  | [表示] |
| 2025/1/22 02:01  | 失敗      | ghi789  | [表示] |
+--------------------------------------------------+
|                                        [閉じる]  |
+--------------------------------------------------+
```

## コンポーネント構成

### 1. ページコンポーネント
- `/routes/scheduler/+page.svelte` - メインページ
- `/routes/scheduler/+page.ts` - データ読み込み

### 2. UIコンポーネント
- `ScheduleList.svelte` - スケジュール一覧
- `ScheduleCard.svelte` - スケジュール行アイテム
- `ScheduleFormDialog.svelte` - 作成/編集ダイアログ
- `ScheduleHistoryDialog.svelte` - 履歴表示ダイアログ
- `CronExpressionInput.svelte` - Cron式入力コンポーネント
- `ScheduleStatusBadge.svelte` - ステータスバッジ

### 3. 状態管理
- `scheduleStore.svelte.ts` - スケジュール状態管理
- WebSocket統合でリアルタイム更新

## 実装手順

### Phase 1: 基本機能（MVP）
1. スケジュール一覧表示
2. 新規作成機能（基本的なフォーム）
3. 有効/無効の切り替え
4. 削除機能

### Phase 2: 編集機能
1. 既存スケジュールの編集
2. Cron式ヘルパー実装
3. フォームバリデーション強化

### Phase 3: 高度な機能
1. 実行履歴表示
2. 一括操作
3. WebSocketリアルタイム更新
4. 検索・フィルタリング

### Phase 4: UX改善
1. 次回実行時刻のカウントダウン
2. 実行予定のカレンダービュー
3. エラー通知の改善

## API統合

### 使用するサービス
```typescript
// 既存のscheduleServiceを使用
import { scheduleService } from '$lib/services/schedule.service';

// 主な操作
- scheduleService.list() - 一覧取得
- scheduleService.create() - 新規作成
- scheduleService.update() - 更新
- scheduleService.delete() - 削除
- scheduleService.toggle() - 有効/無効切り替え
- scheduleService.getHistory() - 履歴取得
```

### WebSocket統合
```typescript
// スケジュール更新の購読
websocket.subscribe('schedule:*', (message) => {
  // スケジュールの更新をリアルタイムで反映
});
```

## 考慮事項

### 1. エラーハンドリング
- Cron式の検証エラー
- API通信エラー
- 権限エラー

### 2. パフォーマンス
- 大量のスケジュールに対応（仮想スクロール検討）
- 履歴データの遅延読み込み

### 3. アクセシビリティ
- キーボード操作対応
- スクリーンリーダー対応
- 適切なARIAラベル

### 4. 国際化
- 日時表示のローカライズ
- エラーメッセージの多言語対応（将来）

## 参考UI
- GitHub Actions のワークフロー画面
- Jenkins のジョブ設定画面
- cron-job.org のシンプルなUI