import{t as Zt}from"../chunks/Gdk0ABul.js";import{e as te}from"../chunks/DNSHY1Ls.js";import"../chunks/NZTpNUN0.js";import{a as K,o as ee,c as ae,s as q}from"../chunks/l49-8nyp.js";import{e as E,h as $,a as o,p as z,f as g,c as k,n as Q,r as b,b as F,k as re,m as oe,u as se,l as ht,s as p,C as m,B as I,t as J,g as l,d as Dt}from"../chunks/BC3TVD7I.js";import{l as ne,s as le,p as X,r as Y,b as Z,i as St}from"../chunks/DlBJ8HRE.js";import{I as de,s as ie,e as ce}from"../chunks/DsjvRSSA.js";import{c as h}from"../chunks/02-ts27b.js";import{c as tt,B as gt}from"../chunks/D0eVI3ve.js";import{C as ue,a as fe,b as ve,B as he,c as ge}from"../chunks/D8w9bG22.js";import{C as pe}from"../chunks/CBkskisn.js";import{a as et}from"../chunks/CBF8HN5J.js";import{g as _e}from"../chunks/BjUgdKiz.js";import{G as me}from"../chunks/DaxJ1q3M.js";import"../chunks/CvXniH3t.js";import{R as $e}from"../chunks/B8240p39.js";import{f as ke,j as be}from"../chunks/C74-udT0.js";function we(f,t){const n=ne(t,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.525.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 */const s=[["path",{d:"M5 12h14"}],["path",{d:"M12 5v14"}]];de(f,le({name:"plus"},()=>n,{get iconNode(){return s},children:(r,i)=>{var d=E(),S=$(d);ie(S,t,"default",{}),o(r,d)},$$slots:{default:!0}}))}const xe=!1,ye=async({url:f})=>{const t=Number(f.searchParams.get("page"))||1,n=Number(f.searchParams.get("limit"))||20,s=f.searchParams.get("sort")||"createdAt",r=f.searchParams.get("order")||"desc";try{typeof window<"u"&&(console.log("Client-side load function executing"),console.log("Current URL:",window.location.href));const i=await Zt.list({page:t,limit:n,sort:s,order:r});return{tasks:i.data,pagination:i.pagination}}catch(i){console.error("Failed to load tasks:",i),i instanceof Error&&console.error("Error details:",{message:i.message,stack:i.stack}),te(500,"タスクの読み込みに失敗しました")}},da=Object.freeze(Object.defineProperty({__proto__:null,load:ye,prerender:xe},Symbol.toStringTag,{value:"Module"}));var Pe=g('<div data-slot="table-container" class="relative w-full overflow-x-auto"><table><!></table></div>');function Ie(f,t){z(t,!0);let n=X(t,"ref",15,null),s=Y(t,["$$slots","$$events","$$legacy","ref","class","children"]);var r=Pe(),i=k(r);et(i,S=>({"data-slot":"table",class:S,...s}),[()=>tt("w-full caption-bottom text-sm",t.class)]);var d=k(i);K(d,()=>t.children??Q),b(i),Z(i,S=>n(S),()=>n()),b(r),o(f,r),F()}var Te=g("<tbody><!></tbody>");function Ae(f,t){z(t,!0);let n=X(t,"ref",15,null),s=Y(t,["$$slots","$$events","$$legacy","ref","class","children"]);var r=Te();et(r,d=>({"data-slot":"table-body",class:d,...s}),[()=>tt("[&_tr:last-child]:border-0",t.class)]);var i=k(r);K(i,()=>t.children??Q),b(r),Z(r,d=>n(d),()=>n()),o(f,r),F()}var Ce=g("<td><!></td>");function lt(f,t){z(t,!0);let n=X(t,"ref",15,null),s=Y(t,["$$slots","$$events","$$legacy","ref","class","children"]);var r=Ce();et(r,d=>({"data-slot":"table-cell",class:d,...s}),[()=>tt("whitespace-nowrap bg-clip-padding p-2 align-middle [&:has([role=checkbox])]:pr-0",t.class)]);var i=k(r);K(i,()=>t.children??Q),b(r),Z(r,d=>n(d),()=>n()),o(f,r),F()}var De=g("<th><!></th>");function pt(f,t){z(t,!0);let n=X(t,"ref",15,null),s=Y(t,["$$slots","$$events","$$legacy","ref","class","children"]);var r=De();et(r,d=>({"data-slot":"table-head",class:d,...s}),[()=>tt("text-foreground h-10 whitespace-nowrap bg-clip-padding px-2 text-left align-middle font-medium [&:has([role=checkbox])]:pr-0",t.class)]);var i=k(r);K(i,()=>t.children??Q),b(r),Z(r,d=>n(d),()=>n()),o(f,r),F()}var Se=g("<thead><!></thead>");function je(f,t){z(t,!0);let n=X(t,"ref",15,null),s=Y(t,["$$slots","$$events","$$legacy","ref","class","children"]);var r=Se();et(r,d=>({"data-slot":"table-header",class:d,...s}),[()=>tt("[&_tr]:border-b",t.class)]);var i=k(r);K(i,()=>t.children??Q),b(r),Z(r,d=>n(d),()=>n()),o(f,r),F()}var Me=g("<tr><!></tr>");function jt(f,t){z(t,!0);let n=X(t,"ref",15,null),s=Y(t,["$$slots","$$events","$$legacy","ref","class","children"]);var r=Me();et(r,d=>({"data-slot":"table-row",class:d,...s}),[()=>tt("hover:[&,&>svelte-css-wrapper]:[&>th,td]:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",t.class)]);var i=k(r);K(i,()=>t.children??Q),b(r),Z(r,d=>n(d),()=>n()),o(f,r),F()}var Ee=g("<!> ツリー表示",1),Ne=g("<!> 新しいタスク",1),Be=g("<!> <!>",1),Re=g("<!> <!> <!> <!>",1),Ue=g('<div class="flex items-center gap-1 text-xs text-muted-foreground"><!> <span>継続タスク</span></div>'),Le=g('<div class="space-y-1"><p class="truncate"> </p> <!></div>'),Oe=g("<!> <!> <!> <!>",1),We=g("<!> <!>",1),ze=g("<!> <!>",1),Fe=g('<div class="flex justify-center gap-2"><!> <div class="flex items-center px-4"> </div> <!></div>'),Ge=g('<div class="space-y-6"><div class="flex justify-between items-center"><div><h2 class="text-3xl font-bold tracking-tight">タスク一覧</h2> <p class="text-muted-foreground">実行中のタスクを管理</p></div> <div class="flex gap-2"><!> <!></div></div> <!> <!></div>');function ia(f,t){z(t,!0);const n=_e();let s=re(oe(t.data.tasks||[]));se(()=>{ht(s,t.data.tasks||[],!0)});function r(e){const a=e.detail;switch(console.log("[タスク一覧] WebSocketメッセージ受信:",{type:a.type,taskId:a.taskId,data:a.data,currentTaskCount:l(s).length}),a.type){case"task:update":console.log("[タスク一覧] タスク更新:",a),i(a);break;case"task:status":case"task:running":console.log("[タスク一覧] タスク状態を更新（旧形式）:",a),S(a);break;case"task:completed":case"task:failed":case"task:cancelled":console.log("[タスク一覧] タスク完了/失敗/キャンセル（旧形式）:",a),S(a);break;default:console.log("[タスク一覧] 未処理のメッセージタイプ:",a.type)}}function i(e){const c=e.taskId||e.data?.taskId||e.payload?.taskId,a=e.data||e.payload||{},v=a.status;if(console.log("[タスク一覧] handleTaskUpdate:",{messageTaskId:e.taskId,dataTaskId:e.data?.taskId,payloadTaskId:e.payload?.taskId,finalTaskId:c,status:v}),!c){console.warn("[タスク一覧] タスクIDが見つかりません:",e);return}const u=l(s).findIndex(_=>_.taskId===c);if(u>=0){const _={...l(s)[u]};v&&(_.status=v);const w=a.metadata||e.data?.metadata||{};w.completedAt&&(_.completedAt=w.completedAt),w.duration&&(_.duration=w.duration),w.error&&(_.error=w.error),w.workingDirectory&&(_.workingDirectory=w.workingDirectory),_.updatedAt=e.timestamp||a.timestamp||new Date().toISOString(),ht(s,[...l(s).slice(0,u),_,...l(s).slice(u+1)],!0),console.log("[タスク一覧] タスクを更新:",_)}else(v==="pending"||v==="running")&&(console.log("[タスク一覧] 新しいタスクを検出、APIから詳細を取得:",c),d(c))}async function d(e){try{const c=await fetch(`http://localhost:5000/api/tasks/${e}`,{headers:{"Content-Type":"application/json"}});if(c.ok){const a=await c.json();if(!l(s).some(u=>u.taskId===e)){const u={...a,id:a.id||a.taskId};ht(s,[u,...l(s)],!0),console.log("[タスク一覧] 新しいタスクを追加:",u)}}}catch(c){console.error("[タスク一覧] タスク詳細の取得に失敗:",c)}}function S(e){const c=e.taskId||e.data?.taskId||e.payload?.taskId,a=e.data||e.payload||e;if(!c)return;const v=l(s).findIndex(u=>u.taskId===c);if(v!==-1){const u={...l(s)[v]};a.status&&(u.status=a.status),a.updatedAt&&(u.updatedAt=a.updatedAt),a.completedAt&&(u.completedAt=a.completedAt),a.duration&&(u.duration=a.duration),a.error&&(u.error=a.error),ht(s,[...l(s).slice(0,v),u,...l(s).slice(v+1)],!0),console.log("[タスク一覧] タスクを更新:",u)}}function Mt(){console.log("[タスク一覧] すべてのタスクをサブスクライブ"),n.subscribe("*")}ee(()=>{if(window.addEventListener("websocket:message",r),n.connected||n.connect(),n.connected&&n.authenticated)Mt();else{const e=setInterval(()=>{n.connected&&n.authenticated&&(Mt(),clearInterval(e))},100);setTimeout(()=>clearInterval(e),5e3)}}),ae(()=>{window.removeEventListener("websocket:message",r)});function Lt(e){switch(e){case"completed":return"default";case"running":return"secondary";case"failed":return"destructive";case"cancelled":return"outline";default:return"secondary"}}function Ot(e){return e?ke(new Date(e),"yyyy/MM/dd HH:mm",{locale:be}):"-"}function Wt(e){if(!e)return"-";const c=e.split("/");return c[c.length-1]||"-"}function zt(e){window.location.href=`/tasks/${e}`}function Ft(){window.location.href="/tasks/new"}var _t=Ge(),mt=k(_t),Et=p(k(mt),2),Nt=k(Et);gt(Nt,{variant:"outline",onclick:()=>window.location.href="/tasks/tree",children:(e,c)=>{var a=Ee(),v=$(a);me(v,{class:"mr-2 h-4 w-4"}),m(),o(e,a)},$$slots:{default:!0}});var Gt=p(Nt,2);gt(Gt,{onclick:Ft,children:(e,c)=>{var a=Ne(),v=$(a);we(v,{class:"mr-2 h-4 w-4"}),m(),o(e,a)},$$slots:{default:!0}}),b(Et),b(mt);var Bt=p(mt,2);h(Bt,()=>ge,(e,c)=>{c(e,{children:(a,v)=>{var u=ze(),_=$(u);h(_,()=>ue,(N,at)=>{at(N,{children:(B,qt)=>{var rt=Be(),dt=$(rt);h(dt,()=>fe,(ot,st)=>{st(ot,{children:(it,ct)=>{m();var R=I("実行中のタスク");o(it,R)},$$slots:{default:!0}})});var $t=p(dt,2);h($t,()=>pe,(ot,st)=>{st(ot,{children:(it,ct)=>{m();var R=I();J(()=>q(R,`${l(s).length??""} 件のタスク`)),o(it,R)},$$slots:{default:!0}})}),o(B,rt)},$$slots:{default:!0}})});var w=p(_,2);h(w,()=>ve,(N,at)=>{at(N,{children:(B,qt)=>{var rt=E(),dt=$(rt);h(dt,()=>Ie,($t,ot)=>{ot($t,{children:(st,it)=>{var ct=We(),R=$(ct);h(R,()=>je,(kt,bt)=>{bt(kt,{children:(wt,Kt)=>{var nt=E(),xt=$(nt);h(xt,()=>jt,(yt,Pt)=>{Pt(yt,{children:(j,G)=>{var H=Re(),M=$(H);h(M,()=>pt,(y,T)=>{T(y,{children:(A,V)=>{m();var P=I("ステータス");o(A,P)},$$slots:{default:!0}})});var x=p(M,2);h(x,()=>pt,(y,T)=>{T(y,{children:(A,V)=>{m();var P=I("リポジトリ");o(A,P)},$$slots:{default:!0}})});var U=p(x,2);h(U,()=>pt,(y,T)=>{T(y,{children:(A,V)=>{m();var P=I("指示内容");o(A,P)},$$slots:{default:!0}})});var ut=p(U,2);h(ut,()=>pt,(y,T)=>{T(y,{children:(A,V)=>{m();var P=I("作成日時");o(A,P)},$$slots:{default:!0}})}),o(j,H)},$$slots:{default:!0}})}),o(wt,nt)},$$slots:{default:!0}})});var Jt=p(R,2);h(Jt,()=>Ae,(kt,bt)=>{bt(kt,{children:(wt,Kt)=>{var nt=E(),xt=$(nt);{var yt=j=>{var G=E(),H=$(G);ce(H,17,()=>l(s),M=>M.taskId,(M,x)=>{var U=E(),ut=$(U);h(ut,()=>jt,(y,T)=>{T(y,{class:"cursor-pointer hover:bg-muted/50 transition-colors",onclick:()=>zt(l(x).taskId),children:(A,V)=>{var P=Oe(),It=$(P);h(It,()=>lt,(L,O)=>{O(L,{children:(W,Tt)=>{{let C=Dt(()=>Lt(l(x).status));he(W,{get variant(){return l(C)},children:(D,Ut)=>{m();var vt=I();J(()=>q(vt,l(x).status)),o(D,vt)},$$slots:{default:!0}})}},$$slots:{default:!0}})});var ft=p(It,2);h(ft,()=>lt,(L,O)=>{O(L,{class:"text-sm",children:(W,Tt)=>{m();var C=I();J(D=>q(C,D),[()=>Wt(l(x).context?.workingDirectory||l(x).workingDirectory)]),o(W,C)},$$slots:{default:!0}})});var Rt=p(ft,2);h(Rt,()=>lt,(L,O)=>{O(L,{class:"max-w-md",children:(W,Tt)=>{var C=Le(),D=k(C),Ut=k(D,!0);b(D);var vt=p(D,2);{var Xt=At=>{var Ct=Ue(),Yt=k(Ct);$e(Yt,{class:"h-3 w-3"}),m(2),b(Ct),o(At,Ct)};St(vt,At=>{(l(x).continuedFrom||l(x).parentTaskId)&&At(Xt)})}b(C),J(()=>q(Ut,l(x).instruction)),o(W,C)},$$slots:{default:!0}})});var Qt=p(Rt,2);h(Qt,()=>lt,(L,O)=>{O(L,{children:(W,Tt)=>{m();var C=I();J(D=>q(C,D),[()=>Ot(l(x).createdAt)]),o(W,C)},$$slots:{default:!0}})}),o(A,P)},$$slots:{default:!0}})}),o(M,U)}),o(j,G)},Pt=j=>{var G=E(),H=$(G);h(H,()=>jt,(M,x)=>{x(M,{children:(U,ut)=>{var y=E(),T=$(y);h(T,()=>lt,(A,V)=>{V(A,{colspan:4,class:"text-center text-muted-foreground",children:(P,It)=>{m();var ft=I("タスクがありません");o(P,ft)},$$slots:{default:!0}})}),o(U,y)},$$slots:{default:!0}})}),o(j,G)};St(xt,j=>{l(s)&&l(s).length>0?j(yt):j(Pt,!1)})}o(wt,nt)},$$slots:{default:!0}})}),o(st,ct)},$$slots:{default:!0}})}),o(B,rt)},$$slots:{default:!0}})}),o(a,u)},$$slots:{default:!0}})});var Ht=p(Bt,2);{var Vt=e=>{var c=Fe(),a=k(c);{let w=Dt(()=>t.data.pagination.page<=1);gt(a,{variant:"outline",get disabled(){return l(w)},onclick:()=>window.location.href=`/tasks?page=${t.data.pagination.page-1}`,children:(N,at)=>{m();var B=I("前へ");o(N,B)},$$slots:{default:!0}})}var v=p(a,2),u=k(v);b(v);var _=p(v,2);{let w=Dt(()=>t.data.pagination.page>=t.data.pagination.totalPages);gt(_,{variant:"outline",get disabled(){return l(w)},onclick:()=>window.location.href=`/tasks?page=${t.data.pagination.page+1}`,children:(N,at)=>{m();var B=I("次へ");o(N,B)},$$slots:{default:!0}})}b(c),J(()=>q(u,`ページ ${t.data.pagination.page??""} / ${t.data.pagination.totalPages??""}`)),o(e,c)};St(Ht,e=>{t.data.pagination&&t.data.pagination.totalPages>1&&e(Vt)})}b(_t),o(f,_t),F()}export{ia as component,da as universal};
