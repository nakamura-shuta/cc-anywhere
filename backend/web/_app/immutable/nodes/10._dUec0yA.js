import{b as st,C as lt}from"../chunks/CBkskisn.js";import{e as W}from"../chunks/DNSHY1Ls.js";import"../chunks/NZTpNUN0.js";import{e as ct,h as y,a as o,p as ut,f as m,b as vt,c as r,s as e,C as $,r as s,B as F,t as H,g as b,d as X,l as R,k as Y}from"../chunks/BC3TVD7I.js";import{s as C}from"../chunks/l49-8nyp.js";import{l as pt,s as mt,i as ft}from"../chunks/DlBJ8HRE.js";import{c as _}from"../chunks/02-ts27b.js";import"../chunks/B6r5B8p4.js";import{B as Z}from"../chunks/D0eVI3ve.js";import{C as tt,a as at,B as _t,b as et,c as rt}from"../chunks/D8w9bG22.js";import{C as gt}from"../chunks/Htwpaeko.js";import{L as kt,T as xt}from"../chunks/r9BZVVQU.js";import{A as ht}from"../chunks/BEoimOpo.js";import{I as $t}from"../chunks/CIAQN0Aj.js";import"../chunks/CvXniH3t.js";import{I as bt,s as wt}from"../chunks/DsjvRSSA.js";import{f as yt,j as Tt}from"../chunks/C74-udT0.js";function Pt(I,t){const v=pt(t,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.525.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 */const T=[["polygon",{points:"6 3 20 12 6 21 6 3"}]];bt(I,mt({name:"play"},()=>v,{get iconNode(){return T},children:(L,U)=>{var S=ct(),D=y(S);wt(D,t,"default",{}),o(L,S)},$$slots:{default:!0}}))}const Ct=async({params:I})=>{const t=I.id;try{const v=await st.get(`/api/tasks/${t}`);if(v.status!=="completed")throw W(400,"タスクが完了していません。完了したタスクのみ継続できます。");return{parentTask:v}}catch(v){throw console.error("Failed to load parent task:",v),W(404,"タスクが見つかりません")}},ea=Object.freeze(Object.defineProperty({__proto__:null,load:Ct},Symbol.toStringTag,{value:"Module"}));var It=m("<!> 親タスクに戻る",1),Dt=m('<div class="flex items-center justify-between"><!> <!></div>'),Mt=m('<div><p class="text-sm text-muted-foreground">作業ディレクトリ</p> <p class="font-mono text-sm"> </p></div>'),jt=m('<div><p class="text-sm text-muted-foreground">前回の指示内容</p> <p class="whitespace-pre-wrap break-words"> </p></div> <!> <div class="grid grid-cols-2 gap-4"><div><p class="text-sm text-muted-foreground">完了日時</p> <p> </p></div> <div><p class="text-sm text-muted-foreground">実行時間</p> <p> </p></div></div>',1),Bt=m("<!> <!>",1),At=m("<!> <!>",1),Et=m('指示内容 <span class="text-destructive">*</span>',1),St=m('<div class="bg-blue-50 dark:bg-blue-950/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800"><div class="flex gap-2"><!> <div class="text-sm text-blue-800 dark:text-blue-200"><p class="font-semibold mb-1">継続タスクについて</p> <ul class="list-disc list-inside space-y-1"><li>前回の会話履歴が引き継がれます</li> <li>同じ作業ディレクトリで実行されます</li> <li>前回の変更内容を前提として実行できます</li></ul></div></div></div> <div class="space-y-2"><!> <!></div>',1),qt=m("<!> ",1),zt=m("<!> <!> <!>",1),Ft=m('<div class="container mx-auto p-4 md:p-6 max-w-4xl"><div class="mb-6"><!> <h1 class="text-3xl font-bold">継続タスクを作成</h1> <p class="text-muted-foreground mt-2">前回のタスクの結果を踏まえて、新しい指示を入力してください</p></div> <div class="grid gap-6"><!> <!></div></div>');function ra(I,t){ut(t,!0);let v=Y(""),T=Y(!1);function L(c){try{return yt(new Date(c),"yyyy/MM/dd HH:mm:ss",{locale:Tt})}catch{return c}}function U(c){switch(c){case"completed":return"default";case"running":return"secondary";case"failed":return"destructive";case"cancelled":return"outline";default:return"secondary"}}async function S(){if(!b(v).trim()){alert("指示内容を入力してください");return}R(T,!0);const c={instruction:b(v),context:{workingDirectory:t.data.parentTask.context?.workingDirectory||t.data.parentTask.workingDirectory,repositories:t.data.parentTask.context?.repositories},options:{timeout:6e5,async:!0,sdk:{permissionMode:t.data.parentTask.options?.permissionMode||"allow",maxTurns:30}}};console.log("Creating continue task with request:",c),console.log("Parent task:",t.data.parentTask);const w=t.data.parentTask.id||t.data.parentTask.taskId;if(!w)throw console.error("Parent task has no ID:",t.data.parentTask),new Error("親タスクのIDが取得できません");console.log("Using parent task ID:",w);try{const a=await st.post(`/api/tasks/${w}/continue`,c);window.location.href=`/tasks/${a.taskId}`}catch(a){console.error("Failed to create continue task:",a),a instanceof Error&&(console.error("Error details:",{message:a.message,stack:a.stack}),a.response&&console.error("Response error:",a.response)),alert("継続タスクの作成に失敗しました: "+(a instanceof Error?a.message:"不明なエラー")),R(T,!1)}}var D=Ft(),N=r(D),ot=r(N);Z(ot,{variant:"ghost",onclick:()=>window.location.href=`/tasks/${t.data.parentTask.id||t.data.parentTask.taskId}`,class:"gap-2 mb-4",children:(c,w)=>{var a=It(),O=y(a);ht(O,{class:"h-4 w-4"}),$(),o(c,a)},$$slots:{default:!0}}),$(4),s(N);var V=e(N,2),G=r(V);_(G,()=>rt,(c,w)=>{w(c,{children:(a,O)=>{var M=Bt(),j=y(M);_(j,()=>tt,(B,g)=>{g(B,{children:(k,P)=>{var x=Dt(),i=r(x);_(i,()=>at,(p,n)=>{n(p,{children:(l,d)=>{$();var h=F("親タスク情報");o(l,h)},$$slots:{default:!0}})});var u=e(i,2);{let p=X(()=>U(t.data.parentTask.status));_t(u,{get variant(){return b(p)},children:(n,l)=>{$();var d=F();H(()=>C(d,t.data.parentTask.status)),o(n,d)},$$slots:{default:!0}})}s(x),o(k,x)},$$slots:{default:!0}})});var q=e(j,2);_(q,()=>et,(B,g)=>{g(B,{class:"space-y-4",children:(k,P)=>{var x=jt(),i=y(x),u=e(r(i),2),p=r(u,!0);s(u),s(i);var n=e(i,2);{var l=A=>{var E=Mt(),Q=e(r(E),2),it=r(Q,!0);s(Q),s(E),H(()=>C(it,t.data.parentTask.context.workingDirectory)),o(A,E)};ft(n,A=>{t.data.parentTask.context?.workingDirectory&&A(l)})}var d=e(n,2),h=r(d),f=e(r(h),2),J=r(f,!0);s(f),s(h);var z=e(h,2),K=e(r(z),2),dt=r(K,!0);s(K),s(z),s(d),H((A,E)=>{C(p,t.data.parentTask.instruction),C(J,A),C(dt,E)},[()=>L(t.data.parentTask.completedAt||t.data.parentTask.updatedAt),()=>t.data.parentTask.duration?`${Math.round(t.data.parentTask.duration/1e3)}秒`:"-"]),o(k,x)},$$slots:{default:!0}})}),o(a,M)},$$slots:{default:!0}})});var nt=e(G,2);_(nt,()=>rt,(c,w)=>{w(c,{children:(a,O)=>{var M=zt(),j=y(M);_(j,()=>tt,(g,k)=>{k(g,{children:(P,x)=>{var i=At(),u=y(i);_(u,()=>at,(n,l)=>{l(n,{children:(d,h)=>{$();var f=F("新しい指示");o(d,f)},$$slots:{default:!0}})});var p=e(u,2);_(p,()=>lt,(n,l)=>{l(n,{children:(d,h)=>{$();var f=F("前回のタスクの文脈を引き継いで実行されます");o(d,f)},$$slots:{default:!0}})}),o(P,i)},$$slots:{default:!0}})});var q=e(j,2);_(q,()=>et,(g,k)=>{k(g,{class:"space-y-4",children:(P,x)=>{var i=St(),u=y(i),p=r(u),n=r(p);$t(n,{class:"h-5 w-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5"}),$(2),s(p),s(u);var l=e(u,2),d=r(l);kt(d,{for:"instruction",children:(f,J)=>{$();var z=Et();$(),o(f,z)},$$slots:{default:!0}});var h=e(d,2);xt(h,{id:"instruction",placeholder:"前回の結果を踏まえて、次に実行したい内容を入力してください",rows:6,get disabled(){return b(T)},get value(){return b(v)},set value(f){R(v,f,!0)}}),s(l),o(P,i)},$$slots:{default:!0}})});var B=e(q,2);_(B,()=>gt,(g,k)=>{k(g,{children:(P,x)=>{{let i=X(()=>b(T)||!b(v).trim());Z(P,{onclick:S,get disabled(){return b(i)},class:"gap-2",children:(u,p)=>{var n=qt(),l=y(n);Pt(l,{class:"h-4 w-4"});var d=e(l);H(()=>C(d,` ${b(T)?"作成中...":"継続タスクを作成"}`)),o(u,n)},$$slots:{default:!0}})}},$$slots:{default:!0}})}),o(a,M)},$$slots:{default:!0}})}),s(V),s(D),o(I,D),vt()}export{ra as component,ea as universal};
