import{t as te}from"../chunks/Gdk0ABul.js";import{e as ee}from"../chunks/DNSHY1Ls.js";import"../chunks/NZTpNUN0.js";import{a as Q,o as ae,c as re,s as J}from"../chunks/l49-8nyp.js";import{e as E,h,a as s,p as F,f as _,c as b,n as X,r as k,b as G,k as se,m as oe,u as ne,l as pt,s as m,C as $,B as A,g as d,d as $t,t as K}from"../chunks/BC3TVD7I.js";import{l as le,s as de,p as Y,r as Z,b as tt,i as bt}from"../chunks/DlBJ8HRE.js";import{I as ie,s as ce,e as ue}from"../chunks/DsjvRSSA.js";import{c as f}from"../chunks/02-ts27b.js";import{c as et,B as kt}from"../chunks/D0eVI3ve.js";import{C as fe,a as ve,b as ge,B as _e,c as me}from"../chunks/D8w9bG22.js";import{C as he}from"../chunks/CBkskisn.js";import{a as at}from"../chunks/CBF8HN5J.js";import"../chunks/B6r5B8p4.js";import{g as pe}from"../chunks/BjUgdKiz.js";import{G as $e}from"../chunks/DaxJ1q3M.js";import"../chunks/CvXniH3t.js";import{R as be}from"../chunks/B8240p39.js";import{f as ke,j as xe}from"../chunks/C74-udT0.js";function we(u,t){const l=le(t,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.525.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 */const o=[["path",{d:"M5 12h14"}],["path",{d:"M12 5v14"}]];ie(u,de({name:"plus"},()=>l,{get iconNode(){return o},children:(a,v)=>{var n=E(),S=h(n);ce(S,t,"default",{}),s(a,n)},$$slots:{default:!0}}))}const ye=!1,Pe=async({url:u,fetch:t})=>{const l=Number(u.searchParams.get("page"))||1,o=Number(u.searchParams.get("limit"))||20,a=u.searchParams.get("sort")||"createdAt",v=u.searchParams.get("order")||"desc";try{typeof window<"u"&&(console.log("Client-side load function executing"),console.log("Current URL:",window.location.href));const n=await te.list({page:l,limit:o,sort:a,order:v},t);return{tasks:n.data,pagination:n.pagination}}catch(n){console.error("Failed to load tasks:",n),n instanceof Error&&console.error("Error details:",{message:n.message,stack:n.stack}),ee(500,"タスクの読み込みに失敗しました")}},fa=Object.freeze(Object.defineProperty({__proto__:null,load:Pe,prerender:ye},Symbol.toStringTag,{value:"Module"}));var Ie=_('<div data-slot="table-container" class="relative w-full overflow-x-auto"><table><!></table></div>');function Te(u,t){F(t,!0);let l=Y(t,"ref",15,null),o=Z(t,["$$slots","$$events","$$legacy","ref","class","children"]);var a=Ie(),v=b(a);at(v,S=>({"data-slot":"table",class:S,...o}),[()=>et("w-full caption-bottom text-sm",t.class)]);var n=b(v);Q(n,()=>t.children??X),k(v),tt(v,S=>l(S),()=>l()),k(a),s(u,a),G()}var Ce=_("<tbody><!></tbody>");function Ae(u,t){F(t,!0);let l=Y(t,"ref",15,null),o=Z(t,["$$slots","$$events","$$legacy","ref","class","children"]);var a=Ce();at(a,n=>({"data-slot":"table-body",class:n,...o}),[()=>et("[&_tr:last-child]:border-0",t.class)]);var v=b(a);Q(v,()=>t.children??X),k(a),tt(a,n=>l(n),()=>l()),s(u,a),G()}var De=_("<td><!></td>");function ct(u,t){F(t,!0);let l=Y(t,"ref",15,null),o=Z(t,["$$slots","$$events","$$legacy","ref","class","children"]);var a=De();at(a,n=>({"data-slot":"table-cell",class:n,...o}),[()=>et("whitespace-nowrap bg-clip-padding p-2 align-middle [&:has([role=checkbox])]:pr-0",t.class)]);var v=b(a);Q(v,()=>t.children??X),k(a),tt(a,n=>l(n),()=>l()),s(u,a),G()}var Se=_("<th><!></th>");function xt(u,t){F(t,!0);let l=Y(t,"ref",15,null),o=Z(t,["$$slots","$$events","$$legacy","ref","class","children"]);var a=Se();at(a,n=>({"data-slot":"table-head",class:n,...o}),[()=>et("text-foreground h-10 whitespace-nowrap bg-clip-padding px-2 text-left align-middle font-medium [&:has([role=checkbox])]:pr-0",t.class)]);var v=b(a);Q(v,()=>t.children??X),k(a),tt(a,n=>l(n),()=>l()),s(u,a),G()}var je=_("<thead><!></thead>");function Me(u,t){F(t,!0);let l=Y(t,"ref",15,null),o=Z(t,["$$slots","$$events","$$legacy","ref","class","children"]);var a=je();at(a,n=>({"data-slot":"table-header",class:n,...o}),[()=>et("[&_tr]:border-b",t.class)]);var v=b(a);Q(v,()=>t.children??X),k(a),tt(a,n=>l(n),()=>l()),s(u,a),G()}var Ee=_("<tr><!></tr>");function Et(u,t){F(t,!0);let l=Y(t,"ref",15,null),o=Z(t,["$$slots","$$events","$$legacy","ref","class","children"]);var a=Ee();at(a,n=>({"data-slot":"table-row",class:n,...o}),[()=>et("hover:[&,&>svelte-css-wrapper]:[&>th,td]:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",t.class)]);var v=b(a);Q(v,()=>t.children??X),k(a),tt(a,n=>l(n),()=>l()),s(u,a),G()}var Ne=_("<!> ツリー表示",1),Be=_("<!> 新しいタスク",1),Re=_('<span class="text-green-600 text-xs">(リアルタイム更新中)</span>'),Le=_(" <!>",1),Oe=_("<!> <!>",1),Ue=_("<!> <!> <!> <!>",1),We=_('<div class="flex items-center gap-1 text-xs text-muted-foreground"><!> <span>継続タスク</span></div>'),ze=_('<div class="space-y-1"><p class="truncate"> </p> <!></div>'),Fe=_("<!> <!> <!> <!>",1),Ge=_("<!> <!>",1),He=_("<!> <!>",1),Ve=_('<div class="flex justify-center gap-2"><!> <div class="flex items-center px-4"> </div> <!></div>'),qe=_('<div class="space-y-6"><div class="flex justify-between items-center"><div><h2 class="text-3xl font-bold tracking-tight">タスク一覧</h2> <p class="text-muted-foreground">実行中のタスクを管理</p></div> <div class="flex gap-2"><!> <!></div></div> <!> <!></div>');function va(u,t){F(t,!0);const l=pe();let o=se(oe(t.data.tasks||[]));ne(()=>{pt(o,t.data.tasks||[],!0)});function a(r){const e=r.detail;switch(console.log("[タスク一覧] WebSocketメッセージ受信:",{type:e.type,taskId:e.taskId,data:e.data,currentTaskCount:d(o).length}),e.type){case"task:update":console.log("[タスク一覧] タスク更新:",e),v(e);break;case"task:status":case"task:running":console.log("[タスク一覧] タスク状態を更新（旧形式）:",e),S(e);break;case"task:completed":case"task:failed":case"task:cancelled":console.log("[タスク一覧] タスク完了/失敗/キャンセル（旧形式）:",e),S(e);break;default:console.log("[タスク一覧] 未処理のメッセージタイプ:",e.type)}}function v(r){const i=r.payload||r.data||{},e=i.taskId,g=i.status;if(!e){console.warn("[タスク一覧] タスクIDが見つかりません:",r);return}const c=d(o).findIndex(p=>p.taskId===e);if(c>=0){const p={...d(o)[c]};g&&(p.status=g);const x=i.metadata||{};x.completedAt&&(p.completedAt=x.completedAt),x.duration&&(p.duration=x.duration),x.error&&(p.error=x.error),x.workingDirectory&&(p.workingDirectory=x.workingDirectory),p.updatedAt=i.timestamp||new Date().toISOString(),pt(o,[...d(o).slice(0,c),p,...d(o).slice(c+1)],!0),console.log("[タスク一覧] タスクを更新:",p)}else(g==="pending"||g==="running")&&(console.log("[タスク一覧] 新しいタスクを検出、APIから詳細を取得:",e),n(e))}async function n(r){try{const i=await fetch(`http://localhost:5000/api/tasks/${r}`,{headers:{"Content-Type":"application/json"}});if(i.ok){const e=await i.json();if(!d(o).some(c=>c.taskId===r)){const c={...e,id:e.id||e.taskId};pt(o,[c,...d(o)],!0),console.log("[タスク一覧] 新しいタスクを追加:",c)}}}catch(i){console.error("[タスク一覧] タスク詳細の取得に失敗:",i)}}function S(r){const i=r.taskId||r.data?.taskId||r.payload?.taskId,e=r.data||r.payload||r;if(!i)return;const g=d(o).findIndex(c=>c.taskId===i);if(g!==-1){const c={...d(o)[g]};e.status&&(c.status=e.status),e.updatedAt&&(c.updatedAt=e.updatedAt),e.completedAt&&(c.completedAt=e.completedAt),e.duration&&(c.duration=e.duration),e.error&&(c.error=e.error),pt(o,[...d(o).slice(0,g),c,...d(o).slice(g+1)],!0),console.log("[タスク一覧] タスクを更新:",c)}}let Wt=$t(()=>l.connected);function Nt(){console.log("[タスク一覧] すべてのタスクをサブスクライブ"),l.subscribe("*")}ae(()=>{if(window.addEventListener("websocket:message",a),l.connected||l.connect(),l.connected&&l.authenticated)Nt();else{const r=setInterval(()=>{l.connected&&l.authenticated&&(Nt(),clearInterval(r))},100);setTimeout(()=>clearInterval(r),5e3)}}),re(()=>{window.removeEventListener("websocket:message",a)});function zt(r){switch(r){case"completed":return"default";case"running":return"secondary";case"failed":return"destructive";case"cancelled":return"outline";default:return"secondary"}}function Ft(r){return r?ke(new Date(r),"yyyy/MM/dd HH:mm",{locale:xe}):"-"}function Gt(r){if(!r)return"-";const i=r.split("/");return i[i.length-1]||"-"}function Ht(r){window.location.href=`/tasks/${r}`}function Vt(){window.location.href="/tasks/new"}var wt=qe(),yt=b(wt),Bt=m(b(yt),2),Rt=b(Bt);kt(Rt,{variant:"outline",onclick:()=>window.location.href="/tasks/tree",children:(r,i)=>{var e=Ne(),g=h(e);$e(g,{class:"mr-2 h-4 w-4"}),$(),s(r,e)},$$slots:{default:!0}});var qt=m(Rt,2);kt(qt,{onclick:Vt,children:(r,i)=>{var e=Be(),g=h(e);we(g,{class:"mr-2 h-4 w-4"}),$(),s(r,e)},$$slots:{default:!0}}),k(Bt),k(yt);var Lt=m(yt,2);f(Lt,()=>me,(r,i)=>{i(r,{children:(e,g)=>{var c=He(),p=h(c);f(p,()=>fe,(N,rt)=>{rt(N,{children:(B,Qt)=>{var st=Oe(),ut=h(st);f(ut,()=>ve,(ot,nt)=>{nt(ot,{children:(ft,vt)=>{$();var R=A("実行中のタスク");s(ft,R)},$$slots:{default:!0}})});var Pt=m(ut,2);f(Pt,()=>he,(ot,nt)=>{nt(ot,{children:(ft,vt)=>{$();var R=Le(),gt=h(R),lt=m(gt);{var dt=L=>{var It=Re();s(L,It)};bt(lt,L=>{d(Wt)&&L(dt)})}K(()=>J(gt,`${d(o).length??""} 件のタスク `)),s(ft,R)},$$slots:{default:!0}})}),s(B,st)},$$slots:{default:!0}})});var x=m(p,2);f(x,()=>ge,(N,rt)=>{rt(N,{children:(B,Qt)=>{var st=E(),ut=h(st);f(ut,()=>Te,(Pt,ot)=>{ot(Pt,{children:(nt,ft)=>{var vt=Ge(),R=h(vt);f(R,()=>Me,(lt,dt)=>{dt(lt,{children:(L,It)=>{var it=E(),Tt=h(it);f(Tt,()=>Et,(Ct,At)=>{At(Ct,{children:(j,H)=>{var V=Ue(),M=h(V);f(M,()=>xt,(y,I)=>{I(y,{children:(T,q)=>{$();var P=A("ステータス");s(T,P)},$$slots:{default:!0}})});var w=m(M,2);f(w,()=>xt,(y,I)=>{I(y,{children:(T,q)=>{$();var P=A("リポジトリ");s(T,P)},$$slots:{default:!0}})});var O=m(w,2);f(O,()=>xt,(y,I)=>{I(y,{children:(T,q)=>{$();var P=A("指示内容");s(T,P)},$$slots:{default:!0}})});var _t=m(O,2);f(_t,()=>xt,(y,I)=>{I(y,{children:(T,q)=>{$();var P=A("作成日時");s(T,P)},$$slots:{default:!0}})}),s(j,V)},$$slots:{default:!0}})}),s(L,it)},$$slots:{default:!0}})});var gt=m(R,2);f(gt,()=>Ae,(lt,dt)=>{dt(lt,{children:(L,It)=>{var it=E(),Tt=h(it);{var Ct=j=>{var H=E(),V=h(H);ue(V,17,()=>d(o),M=>M.taskId,(M,w)=>{var O=E(),_t=h(O);f(_t,()=>Et,(y,I)=>{I(y,{class:"cursor-pointer hover:bg-muted/50 transition-colors",onclick:()=>Ht(d(w).taskId),children:(T,q)=>{var P=Fe(),Dt=h(P);f(Dt,()=>ct,(U,W)=>{W(U,{children:(z,St)=>{{let C=$t(()=>zt(d(w).status));_e(z,{get variant(){return d(C)},children:(D,Ut)=>{$();var ht=A();K(()=>J(ht,d(w).status)),s(D,ht)},$$slots:{default:!0}})}},$$slots:{default:!0}})});var mt=m(Dt,2);f(mt,()=>ct,(U,W)=>{W(U,{class:"text-sm",children:(z,St)=>{$();var C=A();K(D=>J(C,D),[()=>Gt(d(w).context?.workingDirectory||d(w).workingDirectory)]),s(z,C)},$$slots:{default:!0}})});var Ot=m(mt,2);f(Ot,()=>ct,(U,W)=>{W(U,{class:"max-w-md",children:(z,St)=>{var C=ze(),D=b(C),Ut=b(D,!0);k(D);var ht=m(D,2);{var Yt=jt=>{var Mt=We(),Zt=b(Mt);be(Zt,{class:"h-3 w-3"}),$(2),k(Mt),s(jt,Mt)};bt(ht,jt=>{(d(w).continuedFrom||d(w).parentTaskId)&&jt(Yt)})}k(C),K(()=>J(Ut,d(w).instruction)),s(z,C)},$$slots:{default:!0}})});var Xt=m(Ot,2);f(Xt,()=>ct,(U,W)=>{W(U,{children:(z,St)=>{$();var C=A();K(D=>J(C,D),[()=>Ft(d(w).createdAt)]),s(z,C)},$$slots:{default:!0}})}),s(T,P)},$$slots:{default:!0}})}),s(M,O)}),s(j,H)},At=j=>{var H=E(),V=h(H);f(V,()=>Et,(M,w)=>{w(M,{children:(O,_t)=>{var y=E(),I=h(y);f(I,()=>ct,(T,q)=>{q(T,{colspan:4,class:"text-center text-muted-foreground",children:(P,Dt)=>{$();var mt=A("タスクがありません");s(P,mt)},$$slots:{default:!0}})}),s(O,y)},$$slots:{default:!0}})}),s(j,H)};bt(Tt,j=>{d(o)&&d(o).length>0?j(Ct):j(At,!1)})}s(L,it)},$$slots:{default:!0}})}),s(nt,vt)},$$slots:{default:!0}})}),s(B,st)},$$slots:{default:!0}})}),s(e,c)},$$slots:{default:!0}})});var Jt=m(Lt,2);{var Kt=r=>{var i=Ve(),e=b(i);{let x=$t(()=>t.data.pagination.page<=1);kt(e,{variant:"outline",get disabled(){return d(x)},onclick:()=>window.location.href=`/tasks?page=${t.data.pagination.page-1}`,children:(N,rt)=>{$();var B=A("前へ");s(N,B)},$$slots:{default:!0}})}var g=m(e,2),c=b(g);k(g);var p=m(g,2);{let x=$t(()=>t.data.pagination.page>=t.data.pagination.totalPages);kt(p,{variant:"outline",get disabled(){return d(x)},onclick:()=>window.location.href=`/tasks?page=${t.data.pagination.page+1}`,children:(N,rt)=>{$();var B=A("次へ");s(N,B)},$$slots:{default:!0}})}k(i),K(()=>J(c,`ページ ${t.data.pagination.page??""} / ${t.data.pagination.totalPages??""}`)),s(r,i)};bt(Jt,r=>{t.data.pagination&&t.data.pagination.totalPages>1&&r(Kt)})}k(wt),s(u,wt),G()}export{va as component,fa as universal};
