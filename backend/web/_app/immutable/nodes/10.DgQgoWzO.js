import{b as st,C as lt}from"../chunks/DC4utYBl.js";import{e as W}from"../chunks/DNSHY1Ls.js";import"../chunks/NZTpNUN0.js";import{d as ct,e as y,a as s,p as ut,f as p,b as vt,c as r,s as a,y as k,r as e,x as L,t as N,h as b,V as X,i as E,g as Y}from"../chunks/DsgVtOPg.js";import{s as P}from"../chunks/2BTfzV6r.js";import{l as pt,s as mt,i as ft}from"../chunks/8Ee0J66D.js";import{c as f}from"../chunks/DYtQPdT-.js";import"../chunks/eVFC9t49.js";import{B as Z}from"../chunks/Dgibhu4a.js";import{C as tt,a as at,B as _t,b as rt,c as et}from"../chunks/B6-b1C0K.js";import{C as gt}from"../chunks/BgcQkVeN.js";import{L as $t,T as xt}from"../chunks/BEnxKUvc.js";import{A as ht}from"../chunks/1TIcjB_i.js";import{I as kt}from"../chunks/B-ao4UKH.js";import"../chunks/BVfiLATO.js";import{I as bt,s as yt}from"../chunks/Ctyd3DqP.js";import{f as wt,j as Tt}from"../chunks/C74-udT0.js";function Pt(C,t){const _=pt(t,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.525.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 */const u=[["polygon",{points:"6 3 20 12 6 21 6 3"}]];bt(C,mt({name:"play"},()=>_,{get iconNode(){return u},children:(O,G)=>{var S=ct(),D=y(S);yt(D,t,"default",{}),s(O,S)},$$slots:{default:!0}}))}const Ct=async({params:C,parent:t})=>{const _=C.id;try{const u=await st.get(`/api/tasks/${_}`);if(u.status!=="completed")throw W(400,"タスクが完了していません。完了したタスクのみ継続できます。");return{parentTask:u}}catch(u){throw console.error("Failed to load parent task:",u),W(404,"タスクが見つかりません")}},ra=Object.freeze(Object.defineProperty({__proto__:null,load:Ct},Symbol.toStringTag,{value:"Module"}));var Dt=p("<!> 親タスクに戻る",1),It=p('<div class="flex items-center justify-between"><!> <!></div>'),Mt=p('<div><p class="text-sm text-muted-foreground">作業ディレクトリ</p> <p class="font-mono text-sm"> </p></div>'),jt=p('<div><p class="text-sm text-muted-foreground">前回の指示内容</p> <p class="whitespace-pre-wrap break-words"> </p></div> <!> <div class="grid grid-cols-2 gap-4"><div><p class="text-sm text-muted-foreground">完了日時</p> <p> </p></div> <div><p class="text-sm text-muted-foreground">実行時間</p> <p> </p></div></div>',1),At=p("<!> <!>",1),Bt=p("<!> <!>",1),St=p('指示内容 <span class="text-destructive">*</span>',1),zt=p('<div class="bg-blue-50 dark:bg-blue-950/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800"><div class="flex gap-2"><!> <div class="text-sm text-blue-800 dark:text-blue-200"><p class="font-semibold mb-1">継続タスクについて</p> <ul class="list-disc list-inside space-y-1"><li>前回の会話履歴が引き継がれます</li> <li>同じ作業ディレクトリで実行されます</li> <li>前回の変更内容を前提として実行できます</li></ul></div></div></div> <div class="space-y-2"><!> <!></div>',1),Ft=p("<!> ",1),Ht=p("<!> <!> <!>",1),Lt=p('<div class="container mx-auto p-4 md:p-6 max-w-4xl"><div class="mb-6"><!> <h1 class="text-3xl font-bold">継続タスクを作成</h1> <p class="text-muted-foreground mt-2">前回のタスクの結果を踏まえて、新しい指示を入力してください</p></div> <div class="grid gap-6"><!> <!></div></div>');function ea(C,t){ut(t,!0);let _=Y(""),u=Y(!1);function O(d){try{return wt(new Date(d),"yyyy/MM/dd HH:mm:ss",{locale:Tt})}catch{return d}}function G(d){switch(d){case"completed":return"default";case"running":return"secondary";case"failed":return"destructive";case"cancelled":return"outline";default:return"secondary"}}async function S(){if(!b(_).trim()){alert("指示内容を入力してください");return}E(u,!0);try{const d=await st.post(`/api/tasks/${t.data.parentTask.id}/continue`,{instruction:b(_),context:{workingDirectory:t.data.parentTask.context?.workingDirectory||t.data.parentTask.workingDirectory,repositories:t.data.parentTask.context?.repositories},options:{timeout:6e5,async:!0,sdk:{permissionMode:t.data.parentTask.options?.permissionMode||"allow",maxTurns:30}}});window.location.href=`/tasks/${d.taskId}`}catch(d){console.error("Failed to create continue task:",d),alert("継続タスクの作成に失敗しました"),E(u,!1)}}var D=Lt(),V=r(D),ot=r(V);Z(ot,{variant:"ghost",onclick:()=>window.location.href=`/tasks/${t.data.parentTask.id}`,class:"gap-2 mb-4",children:(d,z)=>{var T=Dt(),q=y(T);ht(q,{class:"h-4 w-4"}),k(),s(d,T)},$$slots:{default:!0}}),k(4),e(V);var J=a(V,2),K=r(J);f(K,()=>et,(d,z)=>{z(d,{children:(T,q)=>{var I=At(),M=y(I);f(M,()=>tt,(j,g)=>{g(j,{children:($,w)=>{var x=It(),i=r(x);f(i,()=>at,(v,o)=>{o(v,{children:(l,n)=>{k();var h=L("親タスク情報");s(l,h)},$$slots:{default:!0}})});var c=a(i,2);{let v=X(()=>G(t.data.parentTask.status));_t(c,{get variant(){return b(v)},children:(o,l)=>{k();var n=L();N(()=>P(n,t.data.parentTask.status)),s(o,n)},$$slots:{default:!0}})}e(x),s($,x)},$$slots:{default:!0}})});var F=a(M,2);f(F,()=>rt,(j,g)=>{g(j,{class:"space-y-4",children:($,w)=>{var x=jt(),i=y(x),c=a(r(i),2),v=r(c,!0);e(c),e(i);var o=a(i,2);{var l=A=>{var B=Mt(),U=a(r(B),2),it=r(U,!0);e(U),e(B),N(()=>P(it,t.data.parentTask.context.workingDirectory)),s(A,B)};ft(o,A=>{t.data.parentTask.context?.workingDirectory&&A(l)})}var n=a(o,2),h=r(n),m=a(r(h),2),Q=r(m,!0);e(m),e(h);var H=a(h,2),R=a(r(H),2),dt=r(R,!0);e(R),e(H),e(n),N((A,B)=>{P(v,t.data.parentTask.instruction),P(Q,A),P(dt,B)},[()=>O(t.data.parentTask.completedAt||t.data.parentTask.updatedAt),()=>t.data.parentTask.duration?`${Math.round(t.data.parentTask.duration/1e3)}秒`:"-"]),s($,x)},$$slots:{default:!0}})}),s(T,I)},$$slots:{default:!0}})});var nt=a(K,2);f(nt,()=>et,(d,z)=>{z(d,{children:(T,q)=>{var I=Ht(),M=y(I);f(M,()=>tt,(g,$)=>{$(g,{children:(w,x)=>{var i=Bt(),c=y(i);f(c,()=>at,(o,l)=>{l(o,{children:(n,h)=>{k();var m=L("新しい指示");s(n,m)},$$slots:{default:!0}})});var v=a(c,2);f(v,()=>lt,(o,l)=>{l(o,{children:(n,h)=>{k();var m=L("前回のタスクの文脈を引き継いで実行されます");s(n,m)},$$slots:{default:!0}})}),s(w,i)},$$slots:{default:!0}})});var F=a(M,2);f(F,()=>rt,(g,$)=>{$(g,{class:"space-y-4",children:(w,x)=>{var i=zt(),c=y(i),v=r(c),o=r(v);kt(o,{class:"h-5 w-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5"}),k(2),e(v),e(c);var l=a(c,2),n=r(l);$t(n,{for:"instruction",children:(m,Q)=>{k();var H=St();k(),s(m,H)},$$slots:{default:!0}});var h=a(n,2);xt(h,{id:"instruction",placeholder:"前回の結果を踏まえて、次に実行したい内容を入力してください",rows:6,get disabled(){return b(u)},get value(){return b(_)},set value(m){E(_,m,!0)}}),e(l),s(w,i)},$$slots:{default:!0}})});var j=a(F,2);f(j,()=>gt,(g,$)=>{$(g,{children:(w,x)=>{{let i=X(()=>b(u)||!b(_).trim());Z(w,{onclick:S,get disabled(){return b(i)},class:"gap-2",children:(c,v)=>{var o=Ft(),l=y(o);Pt(l,{class:"h-4 w-4"});var n=a(l);N(()=>P(n,` ${b(u)?"作成中...":"継続タスクを作成"}`)),s(c,o)},$$slots:{default:!0}})}},$$slots:{default:!0}})}),s(T,I)},$$slots:{default:!0}})}),e(J),e(D),s(C,D),vt()}export{ea as component,ra as universal};
