import{a as st}from"../chunks/BGc_tSxm.js";import{e as W}from"../chunks/DNSHY1Ls.js";import"../chunks/NZTpNUN0.js";import{d as lt,e as y,a as o,p as ct,f as m,b as ut,c as e,s as r,C as $,r as s,B as F,t as H,g as b,h as X,l as R,k as Y}from"../chunks/CibTsHxy.js";import{s as C}from"../chunks/DMzQSiFV.js";import{l as vt,s as pt,i as mt}from"../chunks/D2tfWl3j.js";import{c as _}from"../chunks/Dmq7Nx9n.js";import"../chunks/BhMGurHi.js";import{B as Z}from"../chunks/BkNxBhzy.js";import{B as ft,C as tt,a as at}from"../chunks/Bvs5g0ah.js";import{C as _t}from"../chunks/DP_CO7Qi.js";import{C as gt}from"../chunks/0oRBVGTn.js";import{C as rt,a as et}from"../chunks/CeXjzowc.js";import{L as kt,T as xt}from"../chunks/CqC_3kme.js";import{A as ht}from"../chunks/sbTcS15C.js";import{I as $t}from"../chunks/DjUtEVpV.js";import"../chunks/B5zMa-mz.js";import{I as bt,s as wt}from"../chunks/BBRwJ9cY.js";import{f as yt,j as Tt}from"../chunks/C74-udT0.js";function Pt(I,t){const v=vt(t,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.525.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 */const T=[["polygon",{points:"6 3 20 12 6 21 6 3"}]];bt(I,pt({name:"play"},()=>v,{get iconNode(){return T},children:(L,U)=>{var S=lt(),D=y(S);wt(D,t,"default",{}),o(L,S)},$$slots:{default:!0}}))}const Ct=async({params:I})=>{const t=I.id;try{const v=await st.get(`/api/tasks/${t}`);if(v.status!=="completed")throw W(400,"タスクが完了していません。完了したタスクのみ継続できます。");return{parentTask:v}}catch(v){throw console.error("Failed to load parent task:",v),W(404,"タスクが見つかりません")}},sa=Object.freeze(Object.defineProperty({__proto__:null,load:Ct},Symbol.toStringTag,{value:"Module"}));var It=m("<!> 親タスクに戻る",1),Dt=m('<div class="flex items-center justify-between"><!> <!></div>'),Mt=m('<div><p class="text-sm text-muted-foreground">作業ディレクトリ</p> <p class="font-mono text-sm"> </p></div>'),jt=m('<div><p class="text-sm text-muted-foreground">前回の指示内容</p> <p class="whitespace-pre-wrap break-words"> </p></div> <!> <div class="grid grid-cols-2 gap-4"><div><p class="text-sm text-muted-foreground">完了日時</p> <p> </p></div> <div><p class="text-sm text-muted-foreground">実行時間</p> <p> </p></div></div>',1),Bt=m("<!> <!>",1),At=m("<!> <!>",1),Et=m('指示内容 <span class="text-destructive">*</span>',1),St=m('<div class="bg-blue-50 dark:bg-blue-950/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800"><div class="flex gap-2"><!> <div class="text-sm text-blue-800 dark:text-blue-200"><p class="font-semibold mb-1">継続タスクについて</p> <ul class="list-disc list-inside space-y-1"><li>前回の会話履歴が引き継がれます</li> <li>同じ作業ディレクトリで実行されます</li> <li>前回の変更内容を前提として実行できます</li></ul></div></div></div> <div class="space-y-2"><!> <!></div>',1),qt=m("<!> ",1),zt=m("<!> <!> <!>",1),Ft=m('<div class="container mx-auto p-4 md:p-6 max-w-4xl"><div class="mb-6"><!> <h1 class="text-3xl font-bold">継続タスクを作成</h1> <p class="text-muted-foreground mt-2">前回のタスクの結果を踏まえて、新しい指示を入力してください</p></div> <div class="grid gap-6"><!> <!></div></div>');function oa(I,t){ct(t,!0);let v=Y(""),T=Y(!1);function L(c){try{return yt(new Date(c),"yyyy/MM/dd HH:mm:ss",{locale:Tt})}catch{return c}}function U(c){switch(c){case"completed":return"default";case"running":return"secondary";case"failed":return"destructive";case"cancelled":return"outline";default:return"secondary"}}async function S(){if(!b(v).trim()){alert("指示内容を入力してください");return}R(T,!0);const c={instruction:b(v),context:{workingDirectory:t.data.parentTask.context?.workingDirectory||t.data.parentTask.workingDirectory,repositories:t.data.parentTask.context?.repositories},options:{timeout:6e5,async:!0,sdk:{permissionMode:t.data.parentTask.options?.permissionMode||"allow",maxTurns:30}}};console.log("Creating continue task with request:",c),console.log("Parent task:",t.data.parentTask);const w=t.data.parentTask.id||t.data.parentTask.taskId;if(!w)throw console.error("Parent task has no ID:",t.data.parentTask),new Error("親タスクのIDが取得できません");console.log("Using parent task ID:",w);try{const a=await st.post(`/api/tasks/${w}/continue`,c);window.location.href=`/tasks/${a.taskId}`}catch(a){console.error("Failed to create continue task:",a),a instanceof Error&&(console.error("Error details:",{message:a.message,stack:a.stack}),a.response&&console.error("Response error:",a.response)),alert("継続タスクの作成に失敗しました: "+(a instanceof Error?a.message:"不明なエラー")),R(T,!1)}}var D=Ft(),N=e(D),ot=e(N);Z(ot,{variant:"ghost",onclick:()=>window.location.href=`/tasks/${t.data.parentTask.id||t.data.parentTask.taskId}`,class:"gap-2 mb-4",children:(c,w)=>{var a=It(),O=y(a);ht(O,{class:"h-4 w-4"}),$(),o(c,a)},$$slots:{default:!0}}),$(4),s(N);var V=r(N,2),G=e(V);_(G,()=>at,(c,w)=>{w(c,{children:(a,O)=>{var M=Bt(),j=y(M);_(j,()=>rt,(B,g)=>{g(B,{children:(k,P)=>{var x=Dt(),d=e(x);_(d,()=>et,(p,n)=>{n(p,{children:(l,i)=>{$();var h=F("親タスク情報");o(l,h)},$$slots:{default:!0}})});var u=r(d,2);{let p=X(()=>U(t.data.parentTask.status));ft(u,{get variant(){return b(p)},children:(n,l)=>{$();var i=F();H(()=>C(i,t.data.parentTask.status)),o(n,i)},$$slots:{default:!0}})}s(x),o(k,x)},$$slots:{default:!0}})});var q=r(j,2);_(q,()=>tt,(B,g)=>{g(B,{class:"space-y-4",children:(k,P)=>{var x=jt(),d=y(x),u=r(e(d),2),p=e(u,!0);s(u),s(d);var n=r(d,2);{var l=A=>{var E=Mt(),Q=r(e(E),2),dt=e(Q,!0);s(Q),s(E),H(()=>C(dt,t.data.parentTask.context.workingDirectory)),o(A,E)};mt(n,A=>{t.data.parentTask.context?.workingDirectory&&A(l)})}var i=r(n,2),h=e(i),f=r(e(h),2),J=e(f,!0);s(f),s(h);var z=r(h,2),K=r(e(z),2),it=e(K,!0);s(K),s(z),s(i),H((A,E)=>{C(p,t.data.parentTask.instruction),C(J,A),C(it,E)},[()=>L(t.data.parentTask.completedAt||t.data.parentTask.updatedAt),()=>t.data.parentTask.duration?`${Math.round(t.data.parentTask.duration/1e3)}秒`:"-"]),o(k,x)},$$slots:{default:!0}})}),o(a,M)},$$slots:{default:!0}})});var nt=r(G,2);_(nt,()=>at,(c,w)=>{w(c,{children:(a,O)=>{var M=zt(),j=y(M);_(j,()=>rt,(g,k)=>{k(g,{children:(P,x)=>{var d=At(),u=y(d);_(u,()=>et,(n,l)=>{l(n,{children:(i,h)=>{$();var f=F("新しい指示");o(i,f)},$$slots:{default:!0}})});var p=r(u,2);_(p,()=>_t,(n,l)=>{l(n,{children:(i,h)=>{$();var f=F("前回のタスクの文脈を引き継いで実行されます");o(i,f)},$$slots:{default:!0}})}),o(P,d)},$$slots:{default:!0}})});var q=r(j,2);_(q,()=>tt,(g,k)=>{k(g,{class:"space-y-4",children:(P,x)=>{var d=St(),u=y(d),p=e(u),n=e(p);$t(n,{class:"h-5 w-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5"}),$(2),s(p),s(u);var l=r(u,2),i=e(l);kt(i,{for:"instruction",children:(f,J)=>{$();var z=Et();$(),o(f,z)},$$slots:{default:!0}});var h=r(i,2);xt(h,{id:"instruction",placeholder:"前回の結果を踏まえて、次に実行したい内容を入力してください",rows:6,get disabled(){return b(T)},get value(){return b(v)},set value(f){R(v,f,!0)}}),s(l),o(P,d)},$$slots:{default:!0}})});var B=r(q,2);_(B,()=>gt,(g,k)=>{k(g,{children:(P,x)=>{{let d=X(()=>b(T)||!b(v).trim());Z(P,{onclick:S,get disabled(){return b(d)},class:"gap-2",children:(u,p)=>{var n=qt(),l=y(n);Pt(l,{class:"h-4 w-4"});var i=r(l);H(()=>C(i,` ${b(T)?"作成中...":"継続タスクを作成"}`)),o(u,n)},$$slots:{default:!0}})}},$$slots:{default:!0}})}),o(a,M)},$$slots:{default:!0}})}),s(V),s(D),o(I,D),ut()}export{oa as component,sa as universal};
