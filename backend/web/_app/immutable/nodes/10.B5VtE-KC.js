import{a as st}from"../chunks/BGc_tSxm.js";import{e as W}from"../chunks/DNSHY1Ls.js";import"../chunks/NZTpNUN0.js";import{d as lt,e as P,a as n,p as ct,f as _,b as ut,c as s,s as e,C as b,r as o,B as z,t as F,g as T,h as X,l as J,k as Y}from"../chunks/CibTsHxy.js";import{s as D}from"../chunks/DMzQSiFV.js";import{l as vt,s as pt,i as ft}from"../chunks/D2tfWl3j.js";import{c as k}from"../chunks/Dmq7Nx9n.js";import"../chunks/bHnqJfhe.js";import{B as Z}from"../chunks/BkNxBhzy.js";import{B as mt,C as tt,a as at}from"../chunks/Bvs5g0ah.js";import{C as _t}from"../chunks/DP_CO7Qi.js";import{C as gt}from"../chunks/0oRBVGTn.js";import{C as et,a as rt}from"../chunks/CeXjzowc.js";import{L as kt,T as xt}from"../chunks/CqC_3kme.js";import{A as ht}from"../chunks/sbTcS15C.js";import{I as $t}from"../chunks/DjUtEVpV.js";import"../chunks/B5zMa-mz.js";import{I as yt,s as bt}from"../chunks/BBRwJ9cY.js";import{f as Tt,j as wt}from"../chunks/C74-udT0.js";function Pt(M,t){const f=vt(t,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.525.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 */const C=[["polygon",{points:"6 3 20 12 6 21 6 3"}]];yt(M,pt({name:"play"},()=>f,{get iconNode(){return C},children:(H,U)=>{var N=lt(),j=P(N);bt(j,t,"default",{}),n(H,N)},$$slots:{default:!0}}))}const Ct=async({params:M})=>{const t=M.id;try{const f=await st.get(`/api/tasks/${t}`);if(f.status!=="completed")throw W(400,"タスクが完了していません。完了したタスクのみ継続できます。");return{parentTask:f}}catch(f){throw console.error("Failed to load parent task:",f),W(404,"タスクが見つかりません")}},sa=Object.freeze(Object.defineProperty({__proto__:null,load:Ct},Symbol.toStringTag,{value:"Module"}));var It=_("<!> 親タスクに戻る",1),Dt=_('<div class="flex items-center justify-between"><!> <!></div>'),Mt=_('<div><p class="text-sm text-muted-foreground">作業ディレクトリ</p> <p class="font-mono text-sm"> </p></div>'),jt=_('<div><p class="text-sm text-muted-foreground">前回の指示内容</p> <p class="whitespace-pre-wrap break-words"> </p></div> <!> <div class="grid grid-cols-2 gap-4"><div><p class="text-sm text-muted-foreground">完了日時</p> <p> </p></div> <div><p class="text-sm text-muted-foreground">実行時間</p> <p> </p></div></div>',1),At=_("<!> <!>",1),Bt=_("<!> <!>",1),Et=_('指示内容 <span class="text-destructive">*</span>',1),St=_('<div class="bg-blue-50 dark:bg-blue-950/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800"><div class="flex gap-2"><!> <div class="text-sm text-blue-800 dark:text-blue-200"><p class="font-semibold mb-1">継続タスクについて</p> <ul class="list-disc list-inside space-y-1"><li>前回の会話履歴が引き継がれます</li> <li>同じ作業ディレクトリで実行されます</li> <li>前回の変更内容を前提として実行できます</li></ul></div></div></div> <div class="space-y-2"><!> <!></div>',1),Nt=_("<!> ",1),Ot=_("<!> <!> <!>",1),qt=_('<div class="container mx-auto p-4 md:p-6 max-w-4xl"><div class="mb-6"><!> <h1 class="text-3xl font-bold">継続タスクを作成</h1> <p class="text-muted-foreground mt-2">前回のタスクの結果を踏まえて、新しい指示を入力してください</p></div> <div class="grid gap-6"><!> <!></div></div>');function oa(M,t){ct(t,!0);let f=Y(""),C=Y(!1);function H(u){try{return Tt(new Date(u),"yyyy/MM/dd HH:mm:ss",{locale:wt})}catch{return u}}function U(u){switch(u){case"completed":return"default";case"running":return"secondary";case"failed":return"destructive";case"cancelled":return"outline";default:return"secondary"}}async function N(){if(!T(f).trim()){alert("指示内容を入力してください");return}J(C,!0);const u={instruction:T(f),context:{workingDirectory:t.data.parentTask.context?.workingDirectory||t.data.parentTask.workingDirectory,repositories:t.data.parentTask.context?.repositories},options:{timeout:6e5,async:!0,sdk:{permissionMode:t.data.parentTask.options?.permissionMode||"allow",maxTurns:30}}};console.log("Creating continue task with request:",u),console.log("Parent task:",t.data.parentTask);const w=t.data.parentTask.id||t.data.parentTask.taskId;if(!w)throw console.error("Parent task has no ID:",t.data.parentTask),new Error("親タスクのIDが取得できません");console.log("Using parent task ID:",w);try{const r=await st.post(`/api/tasks/${w}/continue`,u);window.location.href=`/tasks/${r.taskId}`}catch(r){console.error("Failed to create continue task:",r);let v="不明なエラー";if(r&&typeof r=="object"&&"data"in r){const a=r;console.error("API Error details:",{status:a.status,statusText:a.statusText,data:a.data}),a.data?.error?v=a.data.error:a.data?.message?v=a.data.message:typeof a.data=="string"?v=a.data:v=`${a.status} ${a.statusText}`}else r instanceof Error&&(v=r.message);typeof v!="string"&&(v=JSON.stringify(v)),alert("継続タスクの作成に失敗しました: "+v),J(C,!1)}}var j=qt(),L=s(j),ot=s(L);Z(ot,{variant:"ghost",onclick:()=>window.location.href=`/tasks/${t.data.parentTask.id||t.data.parentTask.taskId}`,class:"gap-2 mb-4",children:(u,w)=>{var r=It(),v=P(r);ht(v,{class:"h-4 w-4"}),b(),n(u,r)},$$slots:{default:!0}}),b(4),o(L);var V=e(L,2),G=s(V);k(G,()=>at,(u,w)=>{w(u,{children:(r,v)=>{var a=At(),A=P(a);k(A,()=>et,(B,x)=>{x(B,{children:(h,I)=>{var $=Dt(),l=s($);k(l,()=>rt,(m,i)=>{i(m,{children:(c,d)=>{b();var y=z("親タスク情報");n(c,y)},$$slots:{default:!0}})});var p=e(l,2);{let m=X(()=>U(t.data.parentTask.status));mt(p,{get variant(){return T(m)},children:(i,c)=>{b();var d=z();F(()=>D(d,t.data.parentTask.status)),n(i,d)},$$slots:{default:!0}})}o($),n(h,$)},$$slots:{default:!0}})});var O=e(A,2);k(O,()=>tt,(B,x)=>{x(B,{class:"space-y-4",children:(h,I)=>{var $=jt(),l=P($),p=e(s(l),2),m=s(p,!0);o(p),o(l);var i=e(l,2);{var c=E=>{var S=Mt(),R=e(s(S),2),dt=s(R,!0);o(R),o(S),F(()=>D(dt,t.data.parentTask.context.workingDirectory)),n(E,S)};ft(i,E=>{t.data.parentTask.context?.workingDirectory&&E(c)})}var d=e(i,2),y=s(d),g=e(s(y),2),K=s(g,!0);o(g),o(y);var q=e(y,2),Q=e(s(q),2),it=s(Q,!0);o(Q),o(q),o(d),F((E,S)=>{D(m,t.data.parentTask.instruction),D(K,E),D(it,S)},[()=>H(t.data.parentTask.completedAt||t.data.parentTask.updatedAt),()=>t.data.parentTask.duration?`${Math.round(t.data.parentTask.duration/1e3)}秒`:"-"]),n(h,$)},$$slots:{default:!0}})}),n(r,a)},$$slots:{default:!0}})});var nt=e(G,2);k(nt,()=>at,(u,w)=>{w(u,{children:(r,v)=>{var a=Ot(),A=P(a);k(A,()=>et,(x,h)=>{h(x,{children:(I,$)=>{var l=Bt(),p=P(l);k(p,()=>rt,(i,c)=>{c(i,{children:(d,y)=>{b();var g=z("新しい指示");n(d,g)},$$slots:{default:!0}})});var m=e(p,2);k(m,()=>_t,(i,c)=>{c(i,{children:(d,y)=>{b();var g=z("前回のタスクの文脈を引き継いで実行されます");n(d,g)},$$slots:{default:!0}})}),n(I,l)},$$slots:{default:!0}})});var O=e(A,2);k(O,()=>tt,(x,h)=>{h(x,{class:"space-y-4",children:(I,$)=>{var l=St(),p=P(l),m=s(p),i=s(m);$t(i,{class:"h-5 w-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5"}),b(2),o(m),o(p);var c=e(p,2),d=s(c);kt(d,{for:"instruction",children:(g,K)=>{b();var q=Et();b(),n(g,q)},$$slots:{default:!0}});var y=e(d,2);xt(y,{id:"instruction",placeholder:"前回の結果を踏まえて、次に実行したい内容を入力してください",rows:6,get disabled(){return T(C)},get value(){return T(f)},set value(g){J(f,g,!0)}}),o(c),n(I,l)},$$slots:{default:!0}})});var B=e(O,2);k(B,()=>gt,(x,h)=>{h(x,{children:(I,$)=>{{let l=X(()=>T(C)||!T(f).trim());Z(I,{onclick:N,get disabled(){return T(l)},class:"gap-2",children:(p,m)=>{var i=Nt(),c=P(i);Pt(c,{class:"h-4 w-4"});var d=e(c);F(()=>D(d,` ${T(C)?"作成中...":"継続タスクを作成"}`)),n(p,i)},$$slots:{default:!0}})}},$$slots:{default:!0}})}),n(r,a)},$$slots:{default:!0}})}),o(V),o(j),n(M,j),ut()}export{oa as component,sa as universal};
