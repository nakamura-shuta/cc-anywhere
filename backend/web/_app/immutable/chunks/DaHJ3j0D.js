import{a as d,b as u}from"./vycYFVnX.js";class h extends Error{constructor(t,r,e){super(`API Error: ${t} ${r}`),this.status=t,this.statusText=r,this.data=e,this.name="ApiError"}}class f{baseUrl;constructor(t){this.baseUrl=t||d(),typeof window<"u"&&console.log("ApiClient initialized with baseUrl:",this.baseUrl)}buildUrl(t,r){if(t.startsWith("http://")||t.startsWith("https://")){const o=new URL(t);return r&&Object.entries(r).forEach(([i,a])=>{o.searchParams.append(i,String(a))}),o.toString()}const e=new URL(t,this.baseUrl);return r&&Object.entries(r).forEach(([o,i])=>{e.searchParams.append(o,String(i))}),e.toString()}async fetchWithTimeout(t,r,e=3e4){const o=new AbortController,i=setTimeout(()=>o.abort(),e);try{return await fetch(t,{...r,signal:o.signal})}finally{clearTimeout(i)}}async stream(t,r={}){const{params:e,...o}=r,i=this.buildUrl(t,e),a={headers:{...u(),Accept:"text/event-stream"},...o},n=await this.fetchWithTimeout(i,a,r.timeout);if(!n.ok)throw new h(n.status,n.statusText);if(!n.body)throw new Error("No response body");return n.body}async request(t,r={}){const{params:e,timeout:o,...i}=r,a=this.buildUrl(t,e);typeof window<"u"&&console.log("API Request:",{endpoint:t,baseUrl:this.baseUrl,fullUrl:a,method:i.method||"GET"});const n={headers:u(),...i};try{const s=await this.fetchWithTimeout(a,n,o);if(!s.ok){let c;try{c=await s.json()}catch{c={error:await s.text()}}throw console.error("API Error:",{status:s.status,statusText:s.statusText,errorData:c,endpoint:t,requestBody:i.body}),new h(s.status,s.statusText,c)}return s.status===204?{}:await s.json()}catch(s){throw s instanceof Error?s.name==="AbortError"?new Error("Request timeout"):s:new Error("Unknown error occurred")}}async get(t,r){return this.request(t,{...r,method:"GET"})}async post(t,r,e){return this.request(t,{...e,method:"POST",body:r?JSON.stringify(r):void 0})}async put(t,r,e){return this.request(t,{...e,method:"PUT",body:r?JSON.stringify(r):void 0})}async delete(t,r){return this.request(t,{...r,method:"DELETE"})}async patch(t,r,e){return this.request(t,{...e,method:"PATCH",body:r?JSON.stringify(r):void 0})}}const m=new f;export{f as A,h as a,m as b};
