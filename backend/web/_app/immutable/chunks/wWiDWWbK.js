import"./NZTpNUN0.js";import{k as m,l as s,g as o,u as S,aY as v,m as P,h as T,p as w,d as p,e as d,a as l,b as C,n as O}from"./hUgNfGIw.js";import{a as M}from"./Cw6sL175.js";import{i as y}from"./297qlWCs.js";import{w as a,d as A,e as _}from"./vTdvcoKu.js";import{o as h}from"./DuGWCAUg.js";class b{#t=m(void 0);constructor(e,n){n!==void 0&&s(this.#t,n,!0),a(()=>e(),(i,r)=>{s(this.#t,r,!0)})}get current(){return o(this.#t)}}function U(t){S(()=>()=>{t()})}function k(t){v().then(t)}class x{state;#t;constructor(e,n){this.state=A(e),this.#t=n,this.dispatch=this.dispatch.bind(this)}#e(e){return this.#t[this.state.current][e]??this.state.current}dispatch(e){this.state.current=this.#e(e)}}const E={mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}};class I{opts;#t=m("none");get prevAnimationNameState(){return o(this.#t)}set prevAnimationNameState(e){s(this.#t,e,!0)}#e=m(P({}));get styles(){return o(this.#e)}set styles(e){s(this.#e,e,!0)}initialStatus;previousPresent;machine;present;constructor(e){this.opts=e,this.present=this.opts.open,this.initialStatus=e.open.current?"mounted":"unmounted",this.previousPresent=new b(()=>this.present.current),this.machine=new x(this.initialStatus,E),this.handleAnimationEnd=this.handleAnimationEnd.bind(this),this.handleAnimationStart=this.handleAnimationStart.bind(this),D(this),F(this),R(this)}handleAnimationEnd(e){if(!this.opts.ref.current)return;const n=u(this.opts.ref.current),i=n.includes(e.animationName)||n==="none";e.target===this.opts.ref.current&&i&&this.machine.dispatch("ANIMATION_END")}handleAnimationStart(e){this.opts.ref.current&&e.target===this.opts.ref.current&&(this.prevAnimationNameState=u(this.opts.ref.current))}#n=T(()=>["mounted","unmountSuspended"].includes(this.machine.state.current));get isPresent(){return o(this.#n)}set isPresent(e){s(this.#n,e)}}function D(t){a(()=>t.present.current,()=>{if(!t.opts.ref.current||!(t.present.current!==t.previousPresent.current))return;const n=t.prevAnimationNameState,i=u(t.opts.ref.current);if(t.present.current)t.machine.dispatch("MOUNT");else if(i==="none"||t.styles.display==="none")t.machine.dispatch("UNMOUNT");else{const r=n!==i;t.previousPresent.current&&r?t.machine.dispatch("ANIMATION_OUT"):t.machine.dispatch("UNMOUNT")}})}function F(t){a(()=>t.machine.state.current,()=>{if(!t.opts.ref.current)return;const e=u(t.opts.ref.current);t.prevAnimationNameState=t.machine.state.current==="mounted"?e:"none"})}function R(t){a(()=>t.opts.ref.current,()=>{if(t.opts.ref.current)return t.styles=getComputedStyle(t.opts.ref.current),_(h(t.opts.ref.current,"animationstart",t.handleAnimationStart),h(t.opts.ref.current,"animationcancel",t.handleAnimationEnd),h(t.opts.ref.current,"animationend",t.handleAnimationEnd))})}function u(t){return t&&getComputedStyle(t).animationName||"none"}function J(t,e){w(e,!0);const n=new I({open:A.with(()=>e.open),ref:e.ref});var i=p(),r=d(i);{var N=c=>{var f=p(),g=d(f);M(g,()=>e.presence??O,()=>({present:n.isPresent})),l(c,f)};y(r,c=>{(e.forceMount||e.open||n.isPresent)&&c(N)})}l(t,i),C()}class q{#t;#e=void 0;#n=!1;constructor(e){this.#t=e,U(()=>this.#r())}#r(){this.#e&&(window.cancelAnimationFrame(this.#e),this.#e=void 0),this.#n=!1}run(e){if(this.#n)return;this.#r(),this.#n=!0;const n=this.#t.ref.current;if(!n){this.#n=!1;return}if(typeof n.getAnimations!="function"){this.#i(e);return}this.#e=window.requestAnimationFrame(()=>{const i=n.getAnimations();if(i.length===0){this.#i(e);return}Promise.allSettled(i.map(r=>r.finished)).then(()=>{this.#i(e)})})}#i(e){const n=()=>{e(),this.#n=!1};this.#t.afterTick?k(n):n()}}class K{#t;#e;#n;constructor(e){this.#t=e,this.#e=e.enabled??!0,this.#n=new q({ref:this.#t.ref,afterTick:this.#t.open}),a([()=>this.#t.open.current],([n])=>{this.#e&&this.#n.run(()=>{n===this.#t.open.current&&this.#t.onComplete()})})}}export{K as O,J as P,k as a,b,U as o};
