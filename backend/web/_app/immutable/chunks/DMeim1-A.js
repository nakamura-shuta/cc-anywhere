import{u as O,g as e,d as r}from"./BC3TVD7I.js";import{g as f}from"./BjUgdKiz.js";function w(a){const u=f();O(()=>(u.subscribe(a),()=>{u.unsubscribe(a)}));const n=r(()=>u.getTaskMessages(a)),k=r(()=>e(n).filter(t=>["task:log","task:tool:start","task:tool:end","task:claude:response","task:todo_update"].includes(t.type)).map(t=>{switch(t.type){case"task:log":return t.data?.log||"";case"task:tool:start":return`🛠️ [${t.data?.tool}] 開始${t.data?.input?`: ${JSON.stringify(t.data.input).slice(0,100)}...`:""}`;case"task:tool:end":return`✅ [${t.data?.tool}] ${t.data?.success?"成功":"失敗"}${t.data?.duration?` (${t.data.duration}ms)`:""}`;case"task:claude:response":return`🤖 Claude: ${t.data?.text||""}`;case"task:todo_update":return t.data?.todos?`📝 TODO更新: ${t.data.todos.map(s=>`${s.content} [${s.status}]`).join(", ")}`:"📝 TODO更新";default:return JSON.stringify(t.data)}})),y=r(()=>e(n).filter(t=>t.type==="task:tool:start"||t.type==="task:tool:end").map(t=>({type:t.type,tool:t.data?.tool||"",args:t.data?.input,duration:t.data?.duration,success:t.data?.success,error:t.data?.error,timestamp:t.timestamp||new Date().toISOString()}))),h=r(()=>e(n).filter(t=>t.type==="task:claude:response").map(t=>({response:t.data?.text||"",turnNumber:t.data?.turnNumber,maxTurns:t.data?.maxTurns,timestamp:t.timestamp||new Date().toISOString()}))),m=r(()=>(()=>{const t=e(n).filter(i=>i.type==="task:statistics");if(t.length===0)return null;const s=t[t.length-1];return s.data?.statistics||s.data||null})()),S=r(()=>e(n).filter(t=>t.type==="task:todo_update").map(t=>t.data?.todos&&Array.isArray(t.data.todos)?t.data.todos.map(s=>({id:s.id,content:s.content||"",status:s.status||"",priority:s.priority||"medium",timestamp:t.timestamp||new Date().toISOString()})):[]).flat()),x=r(()=>(()=>{const t=e(n).filter(g=>g.type==="task:progress"),s=e(n).filter(g=>g.type==="task:claude:response"),i=s[s.length-1],p=i?.data?.turnNumber||0,l=i?.data?.maxTurns||0,d=t[t.length-1],c=d?.data?.progress?.phase||d?.data?.phase,b=d?.data?.progress?.message||d?.data?.message||"";let o=0;return c==="setup"?o=10:c==="planning"?o=20:c==="execution"?l>0?o=20+Math.min(60,p/l*60):o=50:c==="cleanup"?o=90:c==="complete"&&(o=100),{percent:o,message:b,turn:p,maxTurns:l,phase:c}})()),$=r(()=>(()=>{const t=e(n).filter(s=>["task:completed","task:failed","task:cancelled","task:update"].includes(s.type));return t.length===0?null:t[t.length-1]})());return{get connected(){return u.connected},get authenticated(){return u.authenticated},get messages(){return e(n)},get logs(){return e(k)},get toolExecutions(){return e(y)},get claudeResponses(){return e(h)},get statistics(){return e(m)},get todoUpdates(){return e(S)},get progress(){return e(x)},get statusChange(){return e($)},clearMessages:()=>u.clearTaskMessages(a)}}function C(){const a=f();return{get connected(){return a.connected},get connecting(){return a.connecting},get authenticated(){return a.authenticated},get error(){return a.error},get isReady(){return a.isReady},connect:()=>a.connect(),disconnect:()=>a.disconnect()}}export{C as a,w as u};
